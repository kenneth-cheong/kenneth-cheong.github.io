<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KW Magic</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="icon"
        href="https://mediaonemarketing.com.sg/wp-content/uploads/2023/11/cropped-MediaOne-M-favicon-logo-32x32.png"
        sizes="32x32">
    <style>
        #navbar a i {
            margin-right: 5%;
            /* Adjust spacing as needed */
        }

        #navbar {
            width: 15%;
            background-color: #004c9d;
            color: white;
            padding: 10px;
            position: fixed;
            height: 100%;
            overflow-y: auto;
            border-radius: 10px;
            transition: width 0.3s;
        }

        /* Styles for smaller screens (e.g., mobile) */
        @media screen and (max-width: 768px) {
            #navbar {
                width: 60px;
                /* Reduced width for smaller screens */
            }

            #navbar img {
                width: 100%;
                /* Smaller logo */
            }

            #navbar span {
                display: none;
                /* Hide text labels */
            }

            #main-content {
                margin-left: 80px;
                /* Adjusted margin for smaller navbar */
            }
        }

        #navbar img {
            display: block;
            width: 80%;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 10%;
            margin-top: 10%;
        }

        #navbar a {
            display: block;
            padding: 10px 15px;
            color: white;
            text-decoration: none;
            transition: background-color 0.3s;
        }

        #navbar a:hover {
            background-color: #0056b3;
        }

        /* Adjust main content area to accommodate the navbar */
        #main-content {
            flex: 1;
            /* Allow main content to take up remaining space */
            margin-left: 17%;
            /* Adjust margin to create space for navbar */
            padding: 20px;
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 10px;
            background-color: #fbf7f5;
            color: #333;
        }

        input,
        select,
        button,
        textarea {
            padding: 10px;
            margin: 10px;
            border-radius: 10px;
            border: 1px solid #fffef7;
            font-family: inherit;
            font-size: 16px;
        }

        button {
            transition: background-color 0.3s, transform 0.1s;
            /* Add transform for a subtle lift effect */
            background-color: #c8c9ca;
        }

        button:hover {
            background-color: #004c9d;
            /* Darker blue on hover */
            transform: translateY(-2px);
            /* Move up slightly on hover */
            cursor: pointer;
            /* Change cursor to a pointer on hover */
            color: white;
        }

        input {
            min-width: 90%;
        }

        textarea {
            min-width: 90%;
            min-height: 100px;
            max-width: 90%;
        }

        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
            background-color: #fffef7;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 6px;
        }

        th,
        td {
            padding: 12px 8px;
            border: 1px solid #ddd;
            font-size: 14px;
            background-color: white;
        }

        th {
            background-color: #004c9d;
            position: sticky;
            color: white;
            top: 10px;
        }

        .error {
            color: red;
            margin-left: 10px;
        }

        .collapsible {
            background-color: #004c9d;
            font-weight: bold;
            color: white;
            cursor: pointer;
            padding: 20px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 18px;
            transition: background-color 0.3s ease;
        }

        .collapsible:hover {
            background-color: #0056b3;
        }

        .collapsible-loading {
            background-color: #ffad33;
        }

        .content {
            display: none;
            padding: 20px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-top: none;
        }

        button.sort-button {
            padding: 3px 6px;
            font-size: 12px;
            margin-left: 5px;
            background-color: #286b37;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }

        button.sort-button:hover {
            background-color: #218838;
        }

        hr {
            border-top: 4px solid rgb(95, 103, 154);
            border-radius: 7px;
            width: 100%;
        }

        .header-container {
            display: flex;
            align-items: center;
            /* Vertically center the items in the container */
            margin: 20px 0;
            /* Add some margin for spacing around the header */
        }

        .header-container img {
            margin-right: 15px;
            /* Space between the image and the text */
            width: 75px;
            /* Adjust the width as needed */
            height: auto;
            /* Maintain aspect ratio */
        }

        h1 {
            margin: 0;
            /* Removes default margin */
            font-size: 36px;
            /* Optional: Adjust font size as needed */
        }

        #keywordListContainer {
            display: flex;
            /* Enable Flexbox layout for columns */
            flex-direction: column;
            /* Stack columns vertically */
            max-width: 100%;
            padding: 2px;
        }

        #keywordListContainer h3 {
            font-size: 1em;
            margin-top: 0;
            /* Reduce default margin */
        }

        .keyword-row {
            /* Style each row */
            display: flex;
            /* Use Flexbox for each row */
            align-items: center;
            /* Vertically center content in each row */
            margin-bottom: 5px;
            max-width: 65%;
        }

        .keyword-column {
            /* Style for each column */
            flex: 1;
            /* Each column takes equal width */
            margin-right: 5px;
            /* Space between columns */
            min-width: 50px;
        }

        .keyword-column:hover {
            font-size: 1.1em;
            cursor: pointer;
        }

        .keyword-column:nth-child(1) {
            /* Keyword column */
            flex: 0 0 60%;
        }

        .keyword-column:nth-child(2) {
            /* Search Volume column */
            flex: 0 0 30%;
        }

        .keyword-column:nth-child(3) {
            /* Difficulty column */
            flex: 0 0 22%;
        }

        input[type="checkbox"] {
            width: 3em;
        }


        .checkbox-column {
            flex: 0 0 5%;
            margin-right: 0;
        }

        .column {
            float: left;
            width: 50%;
        }

        ul {
            max-height: 350px;
            overflow: auto;
            width: 100%;
            list-style-type: none;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            background-color: Window;
        }

        li {
            margin: 5px;
            padding: 0px;
            align-items: left;
        }

        label,
        label-fixed {
            display: block;
            color: WindowText;
            margin: 0;
            padding: 0;
            width: 100%;
        }

        label:hover {
            background-color: #0056b3;
            color: white;
        }

        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1;
            /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: rgb(0, 0, 0);
            /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4);
            /* Black w/ opacity */
        }

        .modal-content {
            background-color: #fefefe;
            margin: 2% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            /* Could be more or less, depending on screen size */
            height: 90%;
            overflow-y: auto;
            border-radius: 10px;
        }

        .close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .modal-content .table-container {
            overflow-x: auto;
            /* Allows horizontal scrolling */
            max-width: 100%;
            /* Limits the width of the container */
        }

        .modal-content table {
            width: 100%;
            border-collapse: collapse;
            /* Ensures borders are neat */
        }

        .modal-content th,
        .modal-content td {
            padding: 5px;
            /* Adds space inside cells */
            /* Adds borders to cells */

            overflow: auto;
            white-space: pre;
            max-width: 300px;
        }

        .modal-content td {
            max-height: 40px;
        }

        .modal-content td:last-child {
            max-height: 100px;
            /* Set a maximum height for the cell */
            overflow-y: auto;
            /* Enable vertical scrolling */
        }

        .modal-content th:nth-child(1),
        .modal-content td:nth-child(1),
        .modal-content th:nth-child(2),
        .modal-content td:nth-child(2) {
            position: sticky;
            left: 0;
            /* Sticks to the left edge */
            z-index: 2;
            /* Makes sure the column stays on top while scrolling horizontally */
        }

        .modal-content th:nth-child(2),
        .modal-content td:nth-child(2) {
            left: 43px;
            /* Adjust based on the width of the first column */
        }
    </style>
</head>

<body>
    <nav id="navbar">
        <img src="https://static.mycareersfuture.gov.sg/images/company/logos/a42a0e5029fd642119584ecdc6218b3a/MEDIAONE%20BUSINESS%20GROUP%20PTE.%20LTD..png"
            alt="MediaOne SEO Agency Logo">
        <a href="#keywordAnalysis"><i class="fas fa-chart-bar"></i> <span>Keyword Analysis</span></a>
        <a href="#technicalSeo"><i class="fas fa-tools"></i> <span>Technical SEO</span></a>
        <a href="#socialAudit"><i class="fas fa-share-alt"></i><span>Social Media Audit</span></a>
        <a href="#SEM"><i class="fas fa-ad"></i> <span>SEM</span></a>
        <a href="#contentGenerator"><i class="fas fa-pen"></i> <span>Content Generator</span></a>
        <a href=""><i class="fas fa-user"></i> <span>Account</span></a>
    </nav>
    <div id="main-content">
        <div class="header-container">
            <h1>MediaOne Magic</h1>
        </div>
        <hr>

        <!-- Input Form for User Data -->
        <div class="column">
            <form id="seoForm">
                <div>
                    <label-fixed for="domain">Targeted Domain:</label-fixed>
                    <input type="url" id="domain" name="domain" required
                        placeholder="Domain: example.com | Webpage: https://www.example.com/">
                    <span class="error" id="domainError"></span>
                </div>
                <div>
                    <label-fixed for="location">Targeted Location or Country (required):</label-fixed>
                    <select id="location" name="location" required>
                        <option value="">Select a location</option>
                        <option value="Singapore">Singapore</option>
                        <option value="Malaysia">Malaysia</option>
                        <option value="Thailand">Thailand</option>
                        <option value="India">India</option>
                        <option value="United States">United States</option>
                        <option value="Indonesia">Indonesia</option>
                    </select>
                </div><br>
                <div>
                    <label-fixed for="keywords">Keyword(s) of Interest (comma or newline separated):</label-fixed><br>
                    <textarea id="keywords" name="keywords" required placeholder="keyword1, keyword2"></textarea>
                    <span class="error" id="keywordsError"></span>
                </div>

                <button type="button" id="analyze" onclick="validateAndSubmit()">Analyze</button>
                <button type="button" id="similar" onclick="similarKeywords()">Generate Similar Keywords</button>
                <button type="button" id="ranking" onclick="rankingKeywords()">Get Ranking Keywords</button>

            </form>
        </div>

        <div class="column">
            <button class="collapsible" id="keyword_suggestions">Keyword Suggestions</button>
            <div class="content" id="keywordSuggestions">
                <div id="keywordListContainer">
                    <h3>Keyword Suggestions:</h3>
                    <div class="keyword-row" id="keywordHeaderRow">
                        <div class="keyword-column" onclick="sortKeywordSuggestions(0)">
                            <strong>Keyword</strong>
                        </div>
                        <div class="keyword-column" onclick="sortKeywordSuggestions(1)">
                            <strong>Search Vol</strong>
                        </div>
                        <div class="keyword-column" onclick="sortKeywordSuggestions(2)">
                            <strong>Difficulty</strong>
                        </div>
                        <div class="checkbox-column"></div><strong>Choose</strong>
                    </div>
                    <ul id="keywordList">
                    </ul>
                </div>
            </div>

            <br>

            <button class="collapsible" id="ranking_keywords">Ranking Keywords</button>
            <div class="content" id="rankingKeywords">
                <div id="keywordListContainer">
                    <h3>Ranked Keywords:</h3>
                    <div class="keyword-row" id="rankedKeywordHeaderRow">
                        <div class="keyword-column" onclick="sortRankedKeywords(0)">
                            <strong>Keyword</strong>
                        </div>
                        <div class="keyword-column" onclick="sortRankedKeywords(1)">
                            <strong>Search Vol</strong>
                        </div>
                        <div class="keyword-column" onclick="sortRankedKeywords(2)">
                            <strong>Rank</strong>
                        </div>
                        <div class="keyword-column" onclick="sortRankedKeywords(3)">
                            <strong>Difficulty</strong>
                        </div>
                        <div class="checkbox-column"></div><strong>Choose</strong>
                    </div>
                    <ul id="rankedKeywordList"></ul>
                </div>
            </div>
        </div>


        <hr>
        <button class="collapsible" id="meta_data">Meta Data</button>
        <div class="content" id="metaData">
            <p>Meta Title: <span id="metaTitle">-</span></p>
            <p>Meta Description: <span id="metaDescription">-</span></p>

        </div>

        <button class="collapsible" id="domain_metrics">Domain Metrics (DA, PA, PageSpeed)</button>
        <div class="content" id="domainMetrics">
            <p>Domain Authority (DA): <span id="da">-</span></p>
            <p>Page Authority (PA): <span id="pa">-</span></p>
            <p>Google PageSpeed: <span id="pagespeed">-</span></p>
            <p>Backlinks Spam Score: <span id="spamScore">-</span></p>
            <p>Backlinks: <span id="backlinks">-</span></p>
            <p>Referring Domains: <span id="refDomains">-</span></p>
            <p>Page Word Count: <span id="wordCount">-</span></p>
            <p>Domain Rank: <span id="domainRank">-</span></p>

        </div>

        <!-- Section for Displaying Results -->
        <hr>
        <button class="collapsible" id="keywordAnalysis">Keyword Analysis</button>
        <div class="content" id="keywordAnalysis">
            <section id="results">
                <table id="keywordResultsHeader">
                    <thead>
                        <tr>
                            <th>Keyword <button class="sort-button" onclick="sortTable(0)">Sort</button></th>
                            <th>Rank <button class="sort-button" onclick="sortTable(1)">Sort</button></th>
                            <th>Search Volume <button class="sort-button" onclick="sortTable(2)">Sort</button></th>
                            <th>KW Difficulty <button class="sort-button" onclick="sortTable(3)">Sort</button></th>
                            <th>Time to Rank <button class="sort-button" onclick="sortTable(4)">Sort</button></th>
                            <th>Location <button class="sort-button" onclick="sortTable(5)">Sort</button></th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="keywordResults">
                        <!-- Dynamic content will be filled here -->
                    </tbody>
                </table>
                <br>
                <button id="downloadCSV">Download CSV</button>
                <button id="open_modal" onclick="openModal()">Open Modal</button>
        </div>
        <hr>
        <button class="collapsible">Technical SEO</button>
        <div class="content" id="technicalSEO">

        </div>
        <hr>
        <button class="collapsible">Social Media Audit</button>
        <div class="content" id="socialAudit">
        </div>

        <hr>
        <button class="collapsible">SEM</button>
        <div class="content" id="SEM">
        </div>

        <hr>
        <button class="collapsible">Content Generator</button>
        <div class="content" id="contentGenerator">
            <form id="content-form">
                <label for="content-type">Type of Content:</label>
                <select id="content-type" name="content-type">
                    <option value="blog-post">Blog Post</option>
                    <option value="instagram-caption">Instagram Caption</option>
                    <option value="facebook-post">Facebook Post</option>
                    <option value="linkedin-post">LinkedIn Post</option>
                </select><br><br>
        
                <label for="reference-url">Reference Webpage URL (Optional):</label><br>
                <input type="url" id="reference-url" name="reference-url"><br><br>
        
                <label for="reference-files">Reference Files/Brand Guide (Optional - Up to 5):</label><br>
                <input type="file" id="reference-files" name="reference-files" multiple><br><br>
        
                <label for="sample-text">Sample Text/Post (Optional):</label><br>
                <textarea id="sample-text" name="sample-text"></textarea><br><br>
        
                <label for="post-info">Content of Post:</label><br>
                <textarea id="post-info" name="post-info"></textarea><br><br>
        
                <button type="submit" id="generate-button">Generate Content</button>
            </form>
        
            <div id="generated-content"></div>
        </div>
    </div>

    <div id="keywordModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <table id="modalTable">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>URL</th>
                        <th>Title</th>
                        <th>Description</th>
                        <th>Domain Rank</th>
                        <th>Backlinks</th>
                        <th>Backlinks Spam Score</th>
                        <th>Referring Domains</th>
                        <th>Internal Links Count</th>
                        <th>External Links Count</th>
                        <th>H1</th>
                        <th>H2</th>
                        <th>H3</th>
                        <th>Image</th>
                        <th>Schema</th>
                        <th>Wordcount</th>
                        <th>Readability</th>
                        <th>Alt Text</th>
                        <th>Table</th>
                        <th>Video</th>
                        <th>List</th>
                        <th>P Tag</th>
                        <th>Word Frequency</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dynamic content will be filled here -->
                </tbody>
            </table>
        </div>

        <!-- JavaScript to Handle API Requests and Display Results -->
        <script>

const form = document.getElementById('content-form');
        const generatedContentDiv = document.getElementById('generated-content');
        const generateButton = document.getElementById('generate-button');

        form.addEventListener('submit', async (event) => {
            event.preventDefault();

            // Disable the button and change text
            generateButton.disabled = true;
            generateButton.textContent = 'Generating Content...';

            const formData = new FormData(form);
            const contentData = {
                "url": formData.get('reference-url'),
                "reference_post": formData.get('sample-text'),
                "content_type": formData.get('content-type'),
                "post_info": formData.get('post-info')
            };

            try {
                const response = await fetch('https://panc0eazwj.execute-api.ap-southeast-1.amazonaws.com/content-generator', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(contentData)
                });

                const data = await response.json();

                // Display the API response or error
                if (response.ok) {
                    generatedContentDiv.innerHTML = `<p>${data}</p>`;
                } else {
                    generatedContentDiv.innerHTML = `<p class="error">Error: ${data.error || response.statusText}</p>`;
                }
            } catch (error) {
                console.error('Error fetching data:', error);
                generatedContentDiv.innerHTML = '<p class="error">An error occurred while fetching data.</p>';
            } finally {
                // Re-enable the button and reset text
                generateButton.disabled = false;
                generateButton.textContent = 'Generate Content';
            }
        });

            let DFSapiKey = null; // Store the API key globally

            async function fetchApiKey() {
                try {
                    const response = await fetch('https://w27787oos5.execute-api.ap-southeast-1.amazonaws.com/new');
                    if (!response.ok) {
                        throw new Error('Error fetching API key: ' + response.statusText);
                    }
                    const data = await response.json();
                    DFSapiKey = data.apiKey; // Assuming the API returns the key in a property named 'apiKey'
                } catch (error) {
                    console.error('Error fetching API key:', error);
                    // Handle error, e.g., display an error message to the user
                }
            }
            window.onload = function () {
                fetchApiKey();
            };

            function similarKeywords() {
                const keywordsInput = document.getElementById('keywords').value.split(/[\n,]+/).map(k => k.trim());
                const location = document.getElementById('location').value;
                document.getElementById('similar').innerText = "Generating...";

                var url = "https://api.dataforseo.com/v3/keywords_data/google_ads/keywords_for_keywords/live";
                var queryString = [{
                    "keywords": keywordsInput,
                    "location_name": location,
                    "sort_by": "search_volume"
                }];
                var headers = {
                    "Accept": "application/json",
                    "Content-Type": "application/json",
                    "Authorization": DFSapiKey
                };
                fetch(url, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(queryString)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log("Similar Keywords:", data);
                        displaySimilarKeywords(data.tasks[0].result);
                        document.getElementById('similar').innerText = "Generate Similar Keywords";
                    })
                    .catch(error => {
                        console.error("Error fetching data:", error);
                        document.getElementById('similar').innerText = "Generate Similar Keywords";
                    });
                document.getElementById("keyword_suggestions").style.backgroundColor = "green";
            }

            function rankingKeywords() {
                var domain = document.getElementById('domain').value;
                var location = document.getElementById('location').value;
                document.getElementById('ranking').innerText = "Generating...";

                var url = "https://api.dataforseo.com/v3/dataforseo_labs/ranked_keywords/live";

                var queryString = [{
                    "target": domain,
                    "location_name": location,
                    "filters": ["ranked_serp_element.serp_item.type", "=", "organic"],
                    "sort_by": ["search_volume", "desc"],
                    "limit": 1000
                }];

                if (domain.includes("http") || domain.includes("www")) {
                    var queryString = [{
                        "target": domain,
                        "location_name": location,
                        "sort_by": "search_volume",
                        "filters": [
                            "ranked_serp_element.serp_item.type", "=", "organic",
                            "ranked_serp_element.serp_item.relative_url", "=", "/"],
                        "sort_by": ["search_volume", "desc"]
                    }];
                }

                var headers = {
                    "Accept": "application/json",
                    "Content-Type": "application/json",
                    "Authorization": DFSapiKey
                };
                fetch(url, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(queryString)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log("Ranking Keywords:", data);
                        displayRankedKeywords(data.tasks[0].result[0].items);
                        document.getElementById('ranking').innerText = "Get Ranking Keywords";
                    })
                    .catch(error => {
                        console.error("Error fetching data:", error);
                        document.getElementById('ranking').innerText = "Get Ranking Keywords";
                    });
                document.getElementById("ranking_keywords").style.backgroundColor = "green";

            }

            function displayRankedKeywords(rankedKeywordsData) {
                const rankedKeywordList = document.getElementById('rankedKeywordList');
                rankedKeywordList.innerHTML = ''; // Clear previous keywords

                const headerCells = Array.from(document.querySelectorAll('#rankedKeywordHeaderRow .keyword-column'));

                rankedKeywordsData.forEach((item, index) => {
                    const keywordData = item.keyword_data;
                    const keywordInfo = item.keyword_data.keyword_info;
                    const rankGroup = item.ranked_serp_element.serp_item.rank_group;

                    const listItem = document.createElement('li');
                    listItem.classList.add('keyword-row');

                    // Keyword column
                    const keywordDiv = document.createElement('div');
                    keywordDiv.classList.add('keyword-column');
                    keywordDiv.style.width = `${headerCells[0].offsetWidth}px`;
                    keywordDiv.textContent = keywordData.keyword;
                    listItem.appendChild(keywordDiv);

                    // Search Volume column
                    const searchVolumeDiv = document.createElement('div');
                    searchVolumeDiv.classList.add('keyword-column');
                    searchVolumeDiv.style.width = `${headerCells[1].offsetWidth}px`;
                    searchVolumeDiv.textContent = keywordInfo.search_volume.toLocaleString() || '-';
                    listItem.appendChild(searchVolumeDiv);

                    // Rank column
                    const rankDiv = document.createElement('div');
                    rankDiv.classList.add('keyword-column');
                    rankDiv.style.width = `${headerCells[2].offsetWidth}px`;
                    rankDiv.textContent = rankGroup || '-';
                    listItem.appendChild(rankDiv);

                    // Difficulty column
                    const difficultyDiv = document.createElement('div');
                    difficultyDiv.classList.add('keyword-column');
                    difficultyDiv.style.width = `${headerCells[3].offsetWidth}px`;
                    difficultyDiv.textContent = Math.round(keywordInfo.competition * 100) / 100 || '-';
                    listItem.appendChild(difficultyDiv);

                    // Checkbox column (keep existing style)
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.classList.add('checkbox-column');
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.name = `chk${index + 1}`;
                    checkbox.id = `chk${index + 1}`;
                    checkbox.value = keywordData.keyword;
                    checkbox.checked = false;
                    checkboxDiv.appendChild(checkbox);
                    listItem.appendChild(checkboxDiv);

                    rankedKeywordList.appendChild(listItem);
                });
            }

            // Function to display in the Keyword Suggestions table
            function displaySimilarKeywords(keywordsData) {
                const keywordList = document.getElementById('keywordList');
                keywordList.innerHTML = ''; // Clear previous keywords

                const headerCells = Array.from(document.querySelectorAll('#keywordHeaderRow .keyword-column'));

                keywordsData.forEach((keywordObj, index) => {
                    const listItem = document.createElement('li');
                    listItem.classList.add('keyword-row');

                    // Keyword column
                    const keywordDiv = document.createElement('div');
                    keywordDiv.classList.add('keyword-column');
                    keywordDiv.style.width = `${headerCells[0].offsetWidth}px`;
                    keywordDiv.textContent = keywordObj.keyword;
                    listItem.appendChild(keywordDiv);

                    // Search Volume column
                    const searchVolumeDiv = document.createElement('div');
                    searchVolumeDiv.classList.add('keyword-column');
                    searchVolumeDiv.style.width = `${headerCells[1].offsetWidth}px`;
                    searchVolumeDiv.textContent = keywordObj.search_volume.toLocaleString() || '-';
                    listItem.appendChild(searchVolumeDiv);

                    // Difficulty column
                    const difficultyDiv = document.createElement('div');
                    difficultyDiv.classList.add('keyword-column');
                    difficultyDiv.style.width = `${headerCells[2].offsetWidth}px`;
                    difficultyDiv.textContent = keywordObj.competition || '-'; // Assuming 'competition' is the difficulty key
                    listItem.appendChild(difficultyDiv);

                    // Checkbox column (keep existing style)
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.classList.add('checkbox-column');

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.name = `chk${index + 1}`;
                    checkbox.id = `chk${index + 1}`;
                    checkbox.value = keywordObj.keyword;
                    checkbox.checked = false;
                    checkboxDiv.appendChild(checkbox);
                    listItem.appendChild(checkboxDiv);

                    keywordList.appendChild(listItem);
                });
            }

            function validateAndSubmit() {
                const domain = document.getElementById('domain').value;
                const keywordsInput = document.getElementById('keywords').value;
                const location = document.getElementById('location').value;

                document.getElementById('domainError').textContent = '';
                document.getElementById('keywordsError').textContent = '';

                if (!domain) {
                    document.getElementById('domainError').textContent = 'Please enter a valid URL.';
                    return;
                }
                if (!keywordsInput) {
                    document.getElementById('keywordsError').textContent = 'Please enter one or more keywords.';
                    return;
                }
                if (!location) {
                    alert("Please select a location.");
                    return;
                }

                const keywords = keywordsInput.split(/[\n,]+/).map(k => k.trim()).filter(Boolean);

                document.getElementById('metaTitle').innerText = "";
                document.getElementById('metaDescription').innerText = "";
                document.getElementById('wordCount').innerText = "";
                document.getElementById('da').innerText = "";
                document.getElementById('pa').innerText = "";
                document.getElementById('spamScore').innerText = "";
                document.getElementById('pagespeed').innerText = '-/100';
                document.getElementById('backlinks').innerText = "";
                document.getElementById('refDomains').innerText = "";

                fetchDomainMetrics(domain);
                processKeywords(keywords, location);
            }

            function fetchDomainMetrics(domain) {
                document.getElementById("domain_metrics").style.backgroundColor = "orange";
                document.getElementById("meta_data").style.backgroundColor = "orange";

                document.getElementById('analyze').innerText = "Analyzing...";

                console.log("Fetching Domain Metrics...");

                //moz 
                var url = "https://a7hptjtc8e.execute-api.ap-southeast-1.amazonaws.com/new";
                var queryString = {
                    "domain": domain
                };
                var headers = {
                    "Accept": "application/json",
                    "Content-Type": "application/json"
                };
                fetch(url, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(queryString)
                })
                    .then(response => {
                        // Check if the response is successful
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log("Moz Metrics:", data); // Log the received data
                        document.getElementById('da').innerText = data.body.results[0].domain_authority;
                        document.getElementById('pa').innerText = data.body.results[0].page_authority;
                        document.getElementById('spamScore').innerText = data.body.results[0].spam_score;
                        document.getElementById('pagespeed').innerText = '-/100';
                        document.getElementById('backlinks').innerText = data.body.results[0].pages_to_root_domain.toLocaleString();
                        document.getElementById('refDomains').innerText = data.body.results[0].root_domains_to_root_domain.toLocaleString();
                    })
                    .catch(error => {
                        console.error("Error fetching data:", error); // Log any errors
                        // Handle the error gracefully, perhaps display an error message to the user
                    });

                //dataforseo
                var url = "https://api.dataforseo.com/v3/on_page/instant_pages";
                var queryString = [{
                    "url": domain,
                    "enable_javascript": true
                }];
                var headers = {
                    "Accept": "application/json",
                    "Content-Type": "application/json",
                    "Authorization": DFSapiKey
                };
                fetch(url, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(queryString)
                })
                    .then(response => {
                        // Check if the response is successful
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log("Instant Pages Metrics:", data); // Log the received data
                        document.getElementById('metaTitle').innerText = data.tasks[0].result[0].items[0].meta.title;
                        document.getElementById('metaDescription').innerText = data.tasks[0].result[0].items[0].meta.description;
                        document.getElementById('wordCount').innerText = data.tasks[0].result[0].items[0].meta.content.plain_text_word_count.toLocaleString();
                    })
                    .catch(error => {
                        console.error("Error fetching data:", error); // Log any errors
                        // Handle the error gracefully, perhaps display an error message to the user
                    });

                var url = "https://api.dataforseo.com/v3/backlinks/summary/live";
                var queryString = [{
                    "target": domain.replace("www.", "").replace("http://", "").replace("https://", "")
                }];
                var headers = {
                    "Accept": "application/json",
                    "Content-Type": "application/json",
                    "Authorization": DFSapiKey
                };
                fetch(url, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(queryString)
                })
                    .then(response => {
                        // Check if the response is successful
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log("Backlinks Data:", data); // Log the received data
                        document.getElementById('domainRank').innerText = data.tasks[0].result[0].rank.toLocaleString();
                    })
                    .catch(error => {
                        console.error("Error fetching data:", error); // Log any errors
                        // Handle the error gracefully, perhaps display an error message to the user
                    });

                document.getElementById("domain_metrics").style.backgroundColor = "green";
                document.getElementById("meta_data").style.backgroundColor = "green";
                document.getElementById('analyze').innerText = "Analyze";

            }

            async function fetchSerpResults(keyword, location, domain) {
                const apiEndpoint = "https://u22k9g2y8c.execute-api.ap-southeast-1.amazonaws.com/new";
                const requestBody = {
                    location: location,
                    keyword: keyword,
                    targeted_url: domain,
                    language: 'English'
                };

                try {
                    const response = await fetch(apiEndpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestBody)
                    });

                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error('Error fetching SERP data:', error);
                    return null;
                }
            }

            async function fetchDomainData(urls) {
                const apiEndpoint = "https://9px7sjbyyb.execute-api.ap-southeast-1.amazonaws.com/new";
                const requestBody = { url_list: urls };

                try {
                    const response = await fetch(apiEndpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestBody)
                    });

                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error('Error fetching domain data:', error);
                    return null;
                }
            }

            async function fetchContentAnalysisData(url) {
                const apiEndpoint = "https://v21e9kd3h1.execute-api.ap-southeast-1.amazonaws.com/timetoRank3";
                const requestBody = { url: url };

                try {
                    const response = await fetch(apiEndpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestBody)
                    });

                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error('Error fetching content analysis data:', error);
                    return null;
                }
            }

            async function processKeywords(keywords, location) {
                document.getElementById("keywordAnalysis").style.backgroundColor = "orange";
                document.getElementById('analyze').innerText = "Analyzing...";
                const table = document.getElementById('keywordResults');

                keywords.forEach(keyword => {
                    // Check if keyword already exists in the table
                    let exists = false;
                    for (let i = 0; i < table.rows.length; i++) {
                        if (table.rows[i].cells[0].textContent === keyword) {
                            exists = true;
                            break;
                        }
                    }

                    if (!exists) {
                        // Only add new keywords
                        const row = table.insertRow(table.rows.length);
                        row.insertCell(0).textContent = keyword;
                        row.insertCell(1).textContent = Math.floor(Math.random() * 100); // rank
                        row.insertCell(2).textContent = Math.floor(Math.random() * 5000); // search volume
                        row.insertCell(3).textContent = 'Medium';
                        row.insertCell(4).textContent = Math.floor(Math.random() * 12 + 1) + ' months';
                        row.insertCell(5).textContent = location;
                        const actionCell = row.insertCell(6);
                        const removeButton = document.createElement('button');
                        removeButton.textContent = 'Remove';
                        removeButton.onclick = function () { removeRow(this); };
                        actionCell.appendChild(removeButton);
                    }
                });

                const keywordList = document.getElementById('keywordList');
                keywordList.innerHTML = ''; // Clear previous keywords

                const headerCells = Array.from(document.querySelectorAll('#keywordHeaderRow .keyword-column'));

                keywords.forEach((keyword, index) => {
                    const listItem = document.createElement('li');
                    listItem.classList.add('keyword-row');

                    // Keyword column
                    const keywordDiv = document.createElement('div');
                    keywordDiv.classList.add('keyword-column');
                    keywordDiv.style.width = `${headerCells[0].offsetWidth}px`; // Set width from header
                    keywordDiv.textContent = keyword;
                    listItem.appendChild(keywordDiv);

                    // Search Volume column
                    const searchVolumeDiv = document.createElement('div');
                    searchVolumeDiv.classList.add('keyword-column');
                    searchVolumeDiv.style.width = `${headerCells[1].offsetWidth}px`; // Set width from header
                    searchVolumeDiv.textContent = Math.floor(Math.random() * 5000).toLocaleString();
                    listItem.appendChild(searchVolumeDiv);

                    // Difficulty column
                    const difficultyDiv = document.createElement('div');
                    difficultyDiv.classList.add('keyword-column');
                    difficultyDiv.style.width = `${headerCells[2].offsetWidth}px`; // Set width from header
                    difficultyDiv.textContent = 'Medium';
                    listItem.appendChild(difficultyDiv);

                    // Checkbox column (keep existing style)
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.classList.add('checkbox-column');

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.name = `chk${index + 1}`;
                    checkbox.id = `chk${index + 1}`;
                    checkbox.value = keyword;
                    checkbox.checked = true;
                    checkboxDiv.appendChild(checkbox);
                    listItem.appendChild(checkboxDiv);
                });
                document.getElementById("keywordAnalysis").style.backgroundColor = "green";


                // get SERPs
                domain = document.getElementById('domain').value;
                language = 'English'; // You can add language selection if neede

                // Loop through each keyword and make API call
                for (const keyword of keywords) {
                    // 1. Fetch SERP Results
                    const serpData = await fetchSerpResults(keyword, location, domain);
                    if (serpData && serpData.statusCode === 200 && serpData.body) {
                        displayApiResponse(serpData); // Assuming this function populates the initial modal table

                        // 2. Fetch Domain Data (if needed, based on serpData)
                        const urls = Object.values(serpData.body).map(item => item.url);
                        const domainData = await fetchDomainData(urls);
                        if (domainData && domainData.statusCode === 200 && domainData.body) {
                            updateModalTableWithDomainData(domainData);
                        }

                        // 3. Fetch Content Analysis Data for each URL from SERP
                        for (const url of urls) {
                            const contentData = await fetchContentAnalysisData(url);
                            if (contentData && contentData.statusCode === 200 && contentData.body) {
                                const modalTable = document
                                    .getElementById("modalTable")
                                    .querySelector("tbody");
                                const rows = modalTable.querySelectorAll("tr");

                                const targetRow = Array.from(rows).find(row => row.cells[1].textContent === url);
                                if (targetRow) {
                                    updateModalTableRow(targetRow, contentData.body);
                                }
                            }
                        }

                        // 4. Fetch On-Page Data for each URL from SERP
                        await fetchOnPageDetails(urls)

                    } else {
                        // Handle error for fetchSerpResults
                    }



                }
                hideLoadingIndicator(modalTable);
            }

            async function fetchOnPageDetails(urls) {
                for (const url of urls) {
                    const onPageData = await fetchOnPageAnalysisData(url);
                    if (onPageData && onPageData.statusCode === 200 && onPageData.body) {
                        const modalTable = document
                            .getElementById("modalTable")
                            .querySelector("tbody");
                        const rows = modalTable.querySelectorAll("tr");

                        const targetRow = Array.from(rows).find(row => row.cells[1].textContent === url);
                        if (targetRow) {
                            updateModalTableRowWithOnPageDetails(targetRow, onPageData.body);
                        }
                    }
                }
            }

            async function fetchOnPageAnalysisData(url) {
                const apiEndpoint = "https://tpl2mrhmc0.execute-api.ap-southeast-1.amazonaws.com/new";
                const requestBody = { url: url };

                try {
                    const response = await fetch(apiEndpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestBody)
                    });

                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error('Error fetching on-page analysis data:', error);
                    return null;
                }
            }

            function updateModalTableRowWithOnPageDetails(row, data) {
                // ... Map the data fields from the API response to the correct columns ... 
                addDataToCell(row, "Alt Text", data.alt_text.join(", ") || "-");
                addDataToCell(row, "Table", data.table || "-");
                addDataToCell(row, "Video", data.video || "-");
                addDataToCell(row, "List", data.list || "-");
                addDataToCell(row, "P Tag", data.p_tag || "-");
                addDataToCell(row, "Word Frequency", JSON.stringify(data.word_frequency) || "-"); // You might need to format this
            }

            // --- Helper functions to show and hide the loading indicator ---
            function showLoadingIndicator(parent) {
                const loadingIndicator = document.getElementById("loadingIndicator");
                parent.parentNode.insertBefore(loadingIndicator, parent); // Insert before the table
                parent.classList.add("loading");
                loadingIndicator.style.display = "block";
            }

            function hideLoadingIndicator(parent) {
                const loadingIndicator = document.getElementById("loadingIndicator");
                loadingIndicator.style.display = "none";
                parent.classList.remove("loading");
            }

            function addDataToCell(row, headerText, data) {
                let cellIndex = Array.from(document.querySelectorAll("#modalTable thead tr th"))
                    .findIndex(th => th.textContent === headerText);

                if (cellIndex !== -1) {
                    // Cell exists, add data to it
                    if (row.cells.length > cellIndex) {
                        row.cells[cellIndex].textContent = data;
                    } else {
                        // Create the cell and add data
                        row.insertCell(cellIndex).textContent = data;
                    }
                } else {
                    console.warn(`Header '${headerText}' not found in the table.`);
                }
            }

            function updateModalTableRow(row, data) {
                // Assuming data.h1, data.h2, etc. structure in the second API response
                addDataToCell(row, "H1", data.h1.join(", ") || "-"); // Join array elements if needed
                addDataToCell(row, "H2", data.h2.join(", ") || "-");
                addDataToCell(row, "H3", data.h3.join(", ") || "-");
                addDataToCell(row, "Image", data.image || "-");
                addDataToCell(row, "Schema", data.schema || "-");
                addDataToCell(row, "Wordcount", data.word_count || "-");
                try {
                    addDataToCell(row, "Readability", data.readability.toFixed(2) || "-");
                } catch (errror) {
                    addDataToCell(row, "Readability", data.readability || "-");
                }

                // ... Add more data fields as needed ...
            }

            function updateModalTableWithDomainData(domainData) {
                const modalTable = document.getElementById("modalTable").querySelector("tbody");
                const rows = modalTable.querySelectorAll("tr");

                rows.forEach(row => {
                    const urlCell = row.querySelector("td:nth-child(2)");
                    const url = urlCell.textContent;

                    if (domainData.body[url]) {
                        const domainMetrics = domainData.body[url];
                        row.insertCell().textContent = domainMetrics.domain_rank || "-";
                        row.insertCell().textContent = domainMetrics.backlinks || "-";
                        row.insertCell().textContent = domainMetrics.backlinks_spam_score || "-";
                        row.insertCell().textContent = domainMetrics.referring_domains || "-";
                        row.insertCell().textContent = domainMetrics.internal_links_count || "-";
                        row.insertCell().textContent = domainMetrics.external_links_count || "-";
                        // Add more cells for other domain metrics as needed
                    } else {
                        // If no data is returned for a URL, add empty cells or "-"
                        for (let i = 0; i < 6; i++) { // Add 6 empty cells (for each metric)
                            row.insertCell().textContent = "-";
                        }
                    }
                });
            }

            function displayApiResponse(data) {
                const modalTable = document
                    .getElementById("modalTable")
                    .querySelector("tbody");
                modalTable.innerHTML = ""; // Clear previous content

                if (data.statusCode === 200 && data.body) {
                    // Assuming the API response body is an object with numbered keys
                    for (const key in data.body) {
                        if (data.body.hasOwnProperty(key)) {
                            const item = data.body[key];
                            const row = modalTable.insertRow();
                            row.insertCell().textContent = key; // Item number
                            row.insertCell().textContent = item.url;
                            row.insertCell().textContent = item.title;
                            row.insertCell().textContent = item.description;
                        }
                    }
                } else {
                    // Handle cases where the API response doesn't have the expected structure
                    const row = modalTable.insertRow();
                    const cell = row.insertCell();
                    cell.colSpan = 4; // Span across all columns
                    cell.textContent = "No data found.";
                }

                openModal();
            }


            // Function to open the modal
            function openModal() {
                document.getElementById("keywordModal").style.display = "block";
            }

            // Function to close the modal
            function closeModal() {
                document.getElementById("keywordModal").style.display = "none";
            }

            function removeRow(button) {
                let row = button.parentNode.parentNode;
                row.parentNode.removeChild(row);
            }

            document.addEventListener('DOMContentLoaded', function () {
                const coll = document.getElementsByClassName("collapsible");
                for (let i = 0; i < coll.length; i++) {
                    coll[i].addEventListener("click", function () {
                        this.classList.toggle("active");
                        const content = this.nextElementSibling;
                        content.style.display = content.style.display === "block" ? "none" : "block";
                    });
                }
            });

            function sortTable(column) {
                const table = document.getElementById("keywordResults");
                const rows = Array.from(table.rows);
                const dir = this.asc ? 'asc' : 'desc';

                rows.sort((a, b) => {
                    // **Convert cell content to numbers before comparison:**
                    const ax = parseFloat(a.cells[column].textContent) || 0; // Use parseFloat for numbers, 0 for non-numeric
                    const bx = parseFloat(b.cells[column].textContent) || 0;

                    return (ax > bx) ? (dir === 'asc' ? 1 : -1) : (ax < bx ? (dir === 'asc' ? -1 : 1) : 0);
                });

                rows.forEach(row => table.appendChild(row));
                this.asc = !this.asc;
            }

            function downloadTableAsCSV() {
                const table = document.getElementById("keywordResultsHeader");
                const rows = Array.from(table.querySelectorAll("tr")); // Select all rows

                // Construct the CSV content
                let csvContent = "data:text/csv;charset=utf-8,";
                rows.forEach(row => {
                    // Select cells, excluding the last one (Action column)
                    const cells = Array.from(row.querySelectorAll("th, td:not(:last-child)"));
                    csvContent += cells.map(cell => `"${cell.textContent.trim().replace(/"/g, '""')}"`).join(",") + "\n";
                });

                // Create a hidden link element and trigger a click to download
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "keyword_analysis.csv");
                document.body.appendChild(link); // Required for Firefox

                link.click(); // This will download the data file
                document.body.removeChild(link); // Cleanup 
            }

            // Attach the download function to the button
            document.getElementById("downloadCSV").addEventListener("click", downloadTableAsCSV);

            let currentKeywordSortColumn = null;
            let keywordSortAscending = true;

            let currentRankedKeywordSortColumn = null;
            let rankedKeywordSortAscending = true;

            function sortKeywordSuggestions(column) {
                const keywordList = document.getElementById('keywordList');
                const listItems = Array.from(keywordList.children);

                if (column === currentKeywordSortColumn) {
                    keywordSortAscending = !keywordSortAscending;
                } else {
                    keywordSortAscending = true;
                    currentKeywordSortColumn = column;
                }

                listItems.sort((a, b) => {
                    const aValue = a.children[column].textContent;
                    const bValue = b.children[column].textContent;

                    // Convert to number for sorting if possible
                    const aNum = parseFloat(aValue.replace(/,/g, ''));
                    const bNum = parseFloat(bValue.replace(/,/g, ''));

                    if (!isNaN(aNum) && !isNaN(bNum)) {
                        return keywordSortAscending ? aNum - bNum : bNum - aNum;
                    } else {
                        return keywordSortAscending
                            ? aValue.localeCompare(bValue)
                            : bValue.localeCompare(aValue);
                    }
                });

                listItems.forEach(item => keywordList.appendChild(item));
            }


            function sortRankedKeywords(column) {
                const keywordList = document.getElementById('rankedKeywordList');
                const listItems = Array.from(keywordList.children);

                if (column === currentRankedKeywordSortColumn) {
                    rankedKeywordSortAscending = !rankedKeywordSortAscending; // Toggle sort direction
                } else {
                    rankedKeywordSortAscending = true; // Start in ascending order
                    currentRankedKeywordSortColumn = column;
                }

                listItems.sort((a, b) => {
                    const aValue = a.children[column].textContent;
                    const bValue = b.children[column].textContent;

                    // Convert to number for sorting if possible
                    const aNum = parseFloat(aValue.replace(/,/g, ''));
                    const bNum = parseFloat(bValue.replace(/,/g, ''));

                    if (!isNaN(aNum) && !isNaN(bNum)) {
                        return rankedKeywordSortAscending ? aNum - bNum : bNum - aNum;
                    } else {
                        return rankedKeywordSortAscending
                            ? aValue.localeCompare(bValue)
                            : bValue.localeCompare(aValue);
                    }
                });

                listItems.forEach(item => keywordList.appendChild(item));
            }

            // When the user clicks on a keyword, open the modal with dummy data


            // Get the modal
            var modal = document.getElementById("keywordModal");
            var modalContent = document.getElementById("modalTable").querySelector("tbody");

            // Get the <span> element that closes the modal
            var span = document.getElementsByClassName("close")[0];

            // When the user clicks on <span> (x), close the modal
            span.onclick = function () {
                modal.style.display = "none";
            }

            // When the user clicks anywhere outside of the modal, close it
            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        </script>

</body>

</html>