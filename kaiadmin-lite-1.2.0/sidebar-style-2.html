<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Digimetrics - New Look</title>
  <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport" />
  <link rel="icon"
    href="https://mediaonemarketing.com.sg/wp-content/uploads/2023/11/cropped-MediaOne-M-favicon-logo-32x32.png"
    type="image/x-icon" />

  <!-- Fonts and icons -->
  <script src="assets/js/plugin/webfont/webfont.min.js"></script>
  <script>
    WebFont.load({
      google: { families: ["Public Sans:300,400,500,600,700"] },
      custom: {
        families: [
          "Font Awesome 5 Solid",
          "Font Awesome 5 Regular",
          "Font Awesome 5 Brands",
          "simple-line-icons",
        ],
        urls: ["assets/css/fonts.min.css"],
      },
      active: function () {
        sessionStorage.fonts = true;
      },
    });
  </script>

  <!-- CSS Files -->
  <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
  <link rel="stylesheet" href="assets/css/plugins.min.css" />
  <link rel="stylesheet" href="assets/css/kaiadmin.min.css" />

  <script src="assets/js/driver.js.iife.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/driver.js@latest/dist/driver.css" />
</head>

<body>
  <div class="wrapper">
    <!-- Sidebar -->
    <div class="sidebar sidebar-style-2" data-background-color="dark">
      <div class="sidebar-logo">
        <!-- Logo Header -->
        <div class="logo-header" data-background-color="dark">
          <a href="#" class="logo">
            <img src="assets/img/kaiadmin/Digimetrics Logo-02.png" alt="navbar brand" class="navbar-brand"
              height="20" />
          </a>
          <div class="nav-toggle">
            <button class="btn btn-toggle toggle-sidebar">
              <i class="gg-menu-right"></i>
            </button>
            <button class="btn btn-toggle sidenav-toggler">
              <i class="gg-menu-left"></i>
            </button>
          </div>
          <button class="topbar-toggler more">
            <i class="gg-more-vertical-alt"></i>
          </button>
        </div>
        <!-- End Logo Header -->
      </div>
      <div class="sidebar-wrapper scrollbar scrollbar-inner">
        <div class="sidebar-content">
          <ul class="nav nav-secondary">
            <li class="nav-item">
              <a data-bs-toggle="collapse" href="#dashboard" class="collapsed" aria-expanded="false">
                <i class="fas fa-home"></i>
                <p>Dashboard</p>
                <span class="caret"></span>
              </a>
              <div class="collapse" id="dashboard">
                <ul class="nav nav-collapse">
                  <li>
                    <a href="">
                      <span class="sub-item">Dashboard 1</span>
                    </a>
                  </li>
                </ul>
              </div>
            </li>
            <li class="nav-section">
              <span class="sidebar-mini-icon">
                <i class="fa fa-ellipsis-h"></i>
              </span>
              <h4 class="text-section">Components</h4>
            </li>
            <li class="nav-item">
              <a data-bs-toggle="collapse" href="#base">
                <i class="fas fa-layer-group"></i>
                <p>SEO</p>
                <span class="caret"></span>
              </a>
              <div class="collapse" id="base">
                <ul class="nav nav-collapse">
                  <li>
                    <a href="">
                      <span class="sub-item">Keyword Analysis</span>
                    </a>
                  </li>
                  <li>
                    <a href="">
                      <span class="sub-item">Google Crawler Simulator</span>
                    </a>
                  </li>
                  <li>
                    <a href="">
                      <span class="sub-item">Website Technical Audit</span>
                    </a>
                  </li>
                  <li>
                    <a href="">
                      <span class="sub-item">Content Comparison</span>
                    </a>
                  </li>
                  <li>
                    <a href="">
                      <span class="sub-item">On-Page Recommendations</span>
                    </a>
                  </li>
                  <li>
                    <a href="">
                      <span class="sub-item">Rank Checker</span>
                    </a>
                  </li>
                  <li>
                    <a href="">
                      <span class="sub-item">Schema Generator</span>
                    </a>
                  </li>
                </ul>
              </div>
            </li>
            <li class="nav-item">
              <a data-bs-toggle="collapse" href="#maps">
                <i class="fas fa-audio-description"></i>
                <p>SEM</p>
                <span class="caret"></span>
              </a>
              <div class="collapse" id="maps">
                <ul class="nav nav-collapse">
                  <li>
                    <a href="">
                      <span class="sub-item">Landing Page Audit</span>
                    </a>
                  </li>
                  <li>
                    <a href="">
                      <span class="sub-item">Competitors' Ads</span>
                    </a>
                  </li>
                  <li>
                    <a href="">
                      <span class="sub-item">Ads Generator</span>
                    </a>
                  </li>
                  <li>
                    <a href="">
                      <span class="sub-item">Ads Research</span>
                    </a>
                  </li>
                </ul>
              </div>
            </li>
            <li class="nav-item">
              <a data-bs-toggle="collapse" href="#charts">
                <i class="fas fa-podcast"></i>
                <p>Social Media</p>
                <span class="caret"></span>
              </a>
              <div class="collapse" id="charts">
                <ul class="nav nav-collapse">
                  <li>
                    <a href="">
                      <span class="sub-item">Persona Generator</span>
                    </a>
                  </li>
                  <li>
                    <a href="">
                      <span class="sub-item">Copy Generator</span>
                    </a>
                  </li>
                  <li>
                    <a href="">
                      <span class="sub-item">Content Checker</span>
                    </a>
                  </li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <!-- End Sidebar -->

    <div class="main-panel">
      <div class="main-header">
        <div class="main-header-logo">
          <!-- Logo Header -->
          <div class="logo-header" data-background-color="dark">
            <a href="index.html" class="logo">
              <img src="assets/img/kaiadmin/logo_light.svg" alt="navbar brand" class="navbar-brand" height="20" />
            </a>
            <div class="nav-toggle">
              <button class="btn btn-toggle toggle-sidebar">
                <i class="gg-menu-right"></i>
              </button>
              <button class="btn btn-toggle sidenav-toggler">
                <i class="gg-menu-left"></i>
              </button>
            </div>
            <button class="topbar-toggler more">
              <i class="gg-more-vertical-alt"></i>
            </button>
          </div>
          <!-- End Logo Header -->
        </div>
        <!-- Navbar Header -->
        <nav class="navbar navbar-header navbar-header-transparent navbar-expand-lg border-bottom">
          <div class="container-fluid">

            <div class="collapse navbar-collapse" id="navbarNav">
              <div>
                <div style="margin: 10px" id="seoRow">
                  <ul class="breadcrumbs mb-3">
                    <li class="nav-item">
                      <a href="#"> SEO</a>
                    </li>
                    <li class="separator">
                      <i class="icon-arrow-right"></i>
                    </li>
                    <li class="nav-item">
                      <a href="#" style="font-weight:1000;"> Keyword Analysis</a>
                    </li>
                    <li class="separator">
                      <i class="icon-arrow-right"></i>
                    </li>
                    <li class="nav-item">
                      <a href="#"><i class="fas fa-check-circle" style="color: green; margin-right: 5px;"
                          aria-hidden="true"></i> Rank Checker</a>
                    </li>
                    <li class="separator">
                      <i class="icon-arrow-right"></i>
                    </li>
                    <li class="nav-item">
                      <a href="#"><i class="fas fa-check-circle" style="color: green; margin-right: 5px;"
                          aria-hidden="true"></i> Content Comparison</a>
                    </li>
                    <li class="separator">
                      <i class="icon-arrow-right"></i>
                    </li>
                    <li class="nav-item">
                      <a href="#"> On-Page Recommendations</a>
                    </li>
                    <li class="separator">
                      <i class="icon-arrow-right"></i>
                    </li>
                    <li class="nav-item">
                      <a href="#"> Schema Generator</a>
                    </li>
                    <li class="separator">
                      <i class="icon-arrow-right"></i>
                    </li>
                    <li class="nav-item">
                      <a href="#"> Technical Audit</a>
                    </li>
                  </ul>
                </div>
                <div style="margin: 10px" id="semRow">
                  <ul class="breadcrumbs mb-3">
                    <li class="nav-item">
                      <a href="#"> SEM</a>
                    </li>
                    <li class="separator">
                      <i class="icon-arrow-right"></i>
                    </li>
                    <li class="nav-item">
                      <a href="#"> Landing Page Audit</a>
                    </li>
                    <li class="separator">
                      <i class="icon-arrow-right"></i>
                    </li>
                    <li class="nav-item">
                      <a href="#"> Competitors' Ads</a>
                    </li>
                    <li class="separator">
                      <i class="icon-arrow-right"></i>
                    </li>
                    <li class="nav-item">
                      <a href="#"> Ads Research</a>
                    </li>
                    <li class="separator">
                      <i class="icon-arrow-right"></i>
                    </li>
                    <li class="nav-item">
                      <a href="#"> Ads Generator</a>
                    </li>
                  </ul>
                </div>
                <div style="margin: 10px" id="smmRow">
                  <ul class="breadcrumbs mb-3">
                    <li class="nav-item">
                      <a href="#"> Social Media</a>
                    </li>
                    <li class="separator">
                      <i class="icon-arrow-right"></i>
                    </li>
                    <li class="nav-item">
                      <a href="#"> Persona Generator</a>
                    </li>
                    <li class="separator">
                      <i class="icon-arrow-right"></i>
                    </li>
                    <li class="nav-item">
                      <a href="#"> Content Generator</a>
                    </li>
                    <li class="separator">
                      <i class="icon-arrow-right"></i>
                    </li>
                    <li class="nav-item">
                      <a href="#"> Content Checker</a>
                    </li>
                  </ul>
                </div>
                <div style="margin: 10px" id="bdRow">
                  <ul class="breadcrumbs mb-3">
                    <li class="nav-item">
                      <a href="#"> BD</a>
                    </li>
                    <li class="separator">
                      <i class="icon-arrow-right"></i>
                    </li>
                    <li class="nav-item">
                      <a href="#"> Competitors Identifier</a>
                    </li>
                    <li class="separator">
                      <i class="icon-arrow-right"></i>
                    </li>
                    <li class="nav-item">
                      <a href="#"> Media Plan</a>
                    </li>
                  </ul>
                </div>
              </div>
              <!-- Collapse Button -->
            </div>
            <div class="timeline-badge info">
              <button type="button" class="btn btn-icon btn-round btn-info" id="mascotBtn"
                style="border:none; background-color: transparent;" onclick="driverTesting()">
                <i class="fas fa-question"></i>
                <!--  <img src="assets/img/mascot.png" style="width:50px;" alt="Button Image"> -->
              </button>
            </div>
            <button class="navbar-toggler" style="display:block;" type="button" onclick="toggleRows()">
              <span class="navbar-toggler-icon"></span>
            </button>
          </div>
        </nav>
        <!-- End Navbar -->
      </div>
      <script>
        let rowsHidden = false; // Keep track of the state

        function driverTesting() {
          const driverObj = driver({
            showProgress: false,
            steps: steps
          });

          driverObj.drive();
        }

        function toggleRows() {
          const semRow = document.getElementById('semRow');
          const smmRow = document.getElementById('smmRow');
          const bdRow = document.getElementById('bdRow');

          if (rowsHidden) {
            // Show the rows
            semRow.style.display = "block";
            smmRow.style.display = "block";
            bdRow.style.display = "block";
            rowsHidden = false;
          } else {
            // Hide the rows
            semRow.style.display = "none";
            smmRow.style.display = "none";
            bdRow.style.display = "none";
            rowsHidden = true;
          }
        }

        document.addEventListener('DOMContentLoaded', function () {
          toggleRows();
          const textarea = document.getElementById('keyword_analysis_keywords');
          if (textarea) {
            textarea.addEventListener('input', updateKeywordCount);
            updateKeywordCount(); // Initial count
          } else {
            console.warn('Textarea with ID "keyword_analysis_keywords" not found.');
          }
        });

        function clearKeywordAnalysis() {

        }

        async function serpModal(keyword) {
          const country = document.getElementById('keywordAnalysisCountry').value;
          const language = document.getElementById('keywordAnalysisLanguage').value;
          user = "kenneth@mediaone.co";
          const response = await fetch('https://8k6r15rg4m.execute-api.ap-southeast-1.amazonaws.com/serpLite', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ keyword, language, location: country }),
          });
          const serpData = await response.json();

          console.log(serpData);
          document.getElementById('serpHeader').textContent = 'SERP for ' + keyword;

          populateSerpTable(serpData.body);
        }

        function populateSerpTable(keywords) {
          const tableBody = document.querySelector("#serpTable tbody");

          //Clear existing table rows
          tableBody.innerHTML = "";

          const serpArray = Object.entries(keywords).map(([rank, data]) => ({
            rank: rank,
            url: data.url,
            title: data.title,
            description: data.description
          }));

          //Iterate through the keywords and create table rows
          serpArray.forEach(rank => {
            const row = tableBody.insertRow();
            const rankCell = row.insertCell();
            const urlCell = row.insertCell();
            const titleCell = row.insertCell();
            const descriptionCell = row.insertCell();

            rankCell.textContent = rank.rank;
            urlCell.textContent = rank.url;
            titleCell.textContent = rank.title;
            descriptionCell.textContent = rank.description;
          });

          makeTableSortable('serpTable');
          document.getElementById('serpCard').style.display = "block";
        }

        async function keywordAnalysis() {
          document.getElementById('keywordAnalysisUrlHelp').style.display = "none";
          document.getElementById('keywordAnalysisKeywordsHelp').style.display = "none";
          document.getElementById('keywordAnalysisUrlDiv').classList.remove('has-error', 'has-feedback');
          document.getElementById('keywordAnalysisKeywordsDiv').classList.remove('has-error', 'has-feedback');

          if (!document.getElementById('keyword_analysis_url').value && !document.getElementById('keyword_analysis_keywords').value) {
            document.getElementById('keywordAnalysisUrlHelp').style.display = "block";
            document.getElementById('keywordAnalysisUrlDiv').classList.add('has-error', 'has-feedback');
            document.getElementById('keywordAnalysisKeywordsHelp').style.display = "block";
            document.getElementById('keywordAnalysisKeywordsDiv').classList.add('has-error', 'has-feedback');
          } else {
            document.getElementById('keywordAnalysisSubmit').innerHTML = '<div class="custom-toggle rotate"><i class="icon-settings"></i></div>';
            document.querySelector("#serpTable tbody").innerHTML = "";

            const urlValue = document.getElementById('keyword_analysis_url').value;
            const keywordsValue = document.getElementById('keyword_analysis_keywords').value;
            const domain = document.getElementById('keyword_analysis_url').value;
            const location = document.getElementById('keywordAnalysisCountry').value;
            const language = document.getElementById('keywordAnalysisLanguage').value;
            const keywords = document.getElementById('keyword_analysis_keywords').value.split(/[\n,]+/).map(k => k.trim()).filter(Boolean);

            const promises = [];

            if (urlValue && keywordsValue) {
              promises.push(getKeywordRankings());
            }

            if (urlValue) {
              promises.push(getRankingKeywords());
              promises.push(getWebpageKeywords());
            }

            if (keywordsValue) {
              promises.push(getSimilarKeywords());
            }

            try {
              await Promise.all(promises);

              // Run getTimeToRank concurrently for each keyword
              const timeToRankPromises = keywords.map(keyword => getTimeToRank(keyword, language, location, domain)); // Assuming language, location, urlValue are defined elsewhere.  Important: pass target URL here.
              await Promise.all(timeToRankPromises);

            } catch (error) {
              console.error("One or more keyword analysis tasks failed:", error);
            } finally {
            }
            document.getElementById('keywordAnalysisSubmit').innerHTML = 'Submit';
          }
        }

        let keywordMetrics = {}; // Store search volume and cpc


        async function getTimeToRank(keyword, language, location, target) { //Added the target parameter
          const resultsContainerId = `serp-results-container-${keyword.replace(/\s+/g, '-')}`; // Define container ID here
          try {
            // Create a unique container for each keyword's results
            const resultsContainer = document.createElement('div');
            resultsContainer.id = resultsContainerId;
            // Optionally, add a heading or some initial content to the container
            resultsContainer.innerHTML = `<h4>SERP Results for: ${keyword}</h4>`;
            document.getElementById('serpTable').after(resultsContainer); // Append container to the result table


            const serpEndpoint = 'https://8k6r15rg4m.execute-api.ap-southeast-1.amazonaws.com/serpLite';
            const serpResponse = await fetch(serpEndpoint, {
              method: 'POST',
              headers: {
                'Content-Type': { merge: true, value: 'application/json' }
              },
              body: JSON.stringify({
                keyword: keyword,
                language: language,
                location: location
              })
            });

            if (!serpResponse.ok) {
              throw new Error(`SERP API Error: ${serpResponse.status} ${serpResponse.statusText}`);
            }

            const serpData = await serpResponse.json();
            console.log(`SERP API Response for ${keyword}:`, serpData);

            if (!serpData || !serpData.body) {
              throw new Error(`Invalid SERP API response format for ${keyword}. Expected 'body' property.`);
            }

            const serp_dict = serpData.body;

            // Fetch domain metrics for SERP results and then display them
            const serpResultsWithMetrics = await Promise.all(
              Object.entries(serp_dict).map(async ([rank, result]) => {
                const domainMetrics = await getDomainMetrics(result.url, keyword);
                return {
                  rank: rank,
                  ...result,
                  ...domainMetrics?.body // Add domain metrics to the result object
                };
              })
            );


            // Ensure displaySerpResults receives the container ID
            //displaySerpResults(serpResultsWithMetrics, resultsContainerId);


            const keywordRecommendations = await getKeywordRecommendations(keyword, language, location, target, serp_dict)

            // Await the keyword recommendations
            const timeToRank = keywordRecommendations[0];

            // Update the keywordMetrics object with time to rank
            keywordMetrics[keyword] = {
              ...keywordMetrics[keyword],
              timeToRank: timeToRank,
              mapping: keywordRecommendations[1]
            };

            console.log("Keyword Metrics after keywordAnalysis:", keywordMetrics);

            await displayOverallSummaryTable(location, language, target);

          } catch (error) {
            console.error(`An error occurred for ${keyword}:`, error);
            const container = document.getElementById(resultsContainerId);
            if (container) {
              container.innerHTML = `<p class="error">Error: ${error.message}</p>`;
            } else {
              console.warn(`Results container not found: ${resultsContainerId}`);
            }
          }
        }

        async function displayOverallSummaryTable(location, language, target) {
          keywordsInput = document.getElementById('keyword_analysis_keywords').value;
          keywords = keywordsInput.split(/[\n,]+/).map(k => k.trim()).filter(Boolean);
          const summaryContainer = document.getElementById('overall-summary');
          if (!summaryContainer) {
            console.error("Summary container not found");
            return;
          }

          // Prepare the data for the summary table, using keywordMetrics
          summaryData = keywords.map((keyword, index) => {
            const metrics = keywordMetrics[keyword] || {
              cpc: 'N/A',
              search_volume: 'N/A',
              timeToRank: 'N/A',
              //mapping: '-'
            }; // Provide default values

            return {
              No: index + 1,
              keyword: keyword,
              search_volume: metrics.search_volume || 'N/A',
              cpc: metrics.cpc || 'N/A',
              timeToRank: metrics.timeToRank || 'N/A',
              reason: '', // Initialize the 'Reason' field
              //mapping: metrics.mapping || '',
            };
          });


          let tableHTML = `
              <h2>Overall Keyword Summary</h2>
              <div class="table-container">
                  <table>
                      <thead>
                          <tr>
                              <th>No.</th>
                              <th onclick="sortSummaryTable('keyword')">Keyword</th>
                              <th onclick="sortSummaryTable('search_volume')">Search Volume</th>
                              <th onclick="sortSummaryTable('cpc')">CPC</th>
                              <th onclick="sortSummaryTable('timeToRank')">Time to Rank</th>
                              <th>Reason</th>
                              
                          </tr>
                      </thead>
                      <tbody>
              `;

          for (let index = 0; index < summaryData.length; index++) {
            const item = summaryData[index];
            const timeToRankClass = getTimeToRankClass(item.timeToRank);

            // Fetch initial reason from API
            const reason = await fetchReasonFromAPI(item.keyword, location, language, target);
            summaryData[index].reason = reason; // Update summaryData with initial reason

            tableHTML += `
                <tr>
                  <td>${item.No}</td>
                  <td>${item.keyword}</td>
                  <td>${item.search_volume}</td>
                  <td>${item.cpc}</td>
                  <td class="${timeToRankClass}">${item.timeToRank}</td>
                  <td><textarea class="multiline-input" id="reason-${index}" onchange="updateReason(${index}, this.value)">${reason}</textarea></td>
                  </tr>
              `;
                      }

                      tableHTML += `
                    </tbody>
                </table>
            </div>
            `;

          summaryContainer.innerHTML = tableHTML + '<button id="downloadCsvBtn" onclick="downloadOverallSummaryTableAsCSV()">Download Keyword Summary as CSV</button><br><br>';

          // Show the download button
          document.getElementById('overall-summary').style.display = 'block';
          document.getElementById('downloadCsvBtn').style.display = 'block';
        }

        async function getRankForUrl(url, keyword, language, location) {
          try {
            const rankCheckerResponse = await fetch('https://v5bizygr4m.execute-api.ap-southeast-1.amazonaws.com/rankChecker', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                keyword: keyword,
                language: language,
                location: location,
                target: url // Set target to the current URL
              })
            });

            if (rankCheckerResponse.ok) {
              const rankCheckerData = await rankCheckerResponse.json();
              return rankCheckerData; // Returns rank number.
            } else {
              console.error(`Rank Checker API error for ${url}:`, rankCheckerResponse.status);
              return 'N/A';
            }
          } catch (error) {
            console.error(`Error fetching rank for ${url}:`, error);
            return 'N/A';
          }
        }



        async function getKeywordRecommendations(keyword, language, location, target_url, serp_dict) { //keep target_url here.  It's being passed into this function, which is what we want.
          const keywordMappingEndpoint = 'https://c0bkxhc1s3.execute-api.ap-southeast-1.amazonaws.com/keywordMapping';
          const kwRecommendationsEndpoint = 'https://pkbguam62a.execute-api.ap-southeast-1.amazonaws.com/kwRecommendationsStructured';
          const recommendationsContainerId = `recommendations-container-${keyword.replace(/\s+/g, '-')}`;  // Unique container for recommendations
          const targetContentTableContainerId = `target-content-table-container-${keyword.replace(/\s+/g, '-')}`;

          try {
            // 1. Keyword Mapping API
            const keywordMappingResponse = await fetch(keywordMappingEndpoint, {
              method: 'POST',
              headers: {
                'Content-Type': { merge: true, value: 'application/json' }
              },
              body: JSON.stringify({
                location: location,
                keyword: keyword,
                language: language,
                target: target_url //use target_url instead of target.
              })
            });

            if (!keywordMappingResponse.ok) {
              throw new Error(`Keyword Mapping API Error for ${keyword}: ${keywordMappingResponse.status} ${keywordMappingResponse.statusText}`);
            }

            const keywordMappingData = await keywordMappingResponse.json();
            console.log(`Keyword Mapping API Response for ${keyword}:`, keywordMappingData);

            if (keywordMappingData && keywordMappingData.body && Array.isArray(keywordMappingData.body)) {
              const targetUrls = keywordMappingData.body;

              // 2. Get Domain Metrics for Target URLs & Rank Checking
              const targetDataPromises = targetUrls.map(async (url) => {
                const domainMetrics = await getDomainMetrics(url, keyword);

                return {
                  url: url,
                  ...domainMetrics?.body,
                  title: keywordMappingData.dict[url]?.title || 'N/A',
                  description: keywordMappingData.dict[url]?.description || 'N/A'
                };
              });

              const targetData = await Promise.all(targetDataPromises);

              console.log(`Target Content with Metrics and Rank for ${keyword}:`, targetData);

              //Get the rank from the targetData table
              const targetDataWithRank = await Promise.all(
                targetData.map(async (item) => {
                  const rankData = await getRankForUrl(item.url, keyword, language, location);
                  return {
                    ...item,
                    rank: rankData
                  };
                })
              );

              // 3. Call Keyword Recommendations API
              if (serp_dict) {
                const kwRecommendationsResponse = await fetch(kwRecommendationsEndpoint, {
                  method: 'POST',
                  headers: {
                    'Content-Type': { merge: true, value: 'application/json' }
                  },
                  body: JSON.stringify({
                    keyword: keyword,
                    target_content: targetDataWithRank.map(item => ({ url: item.url, domain_metrics: item, rank: item.rank })), // Pass all data as domain_metrics
                    serps_dict: serp_dict
                  })
                });

                if (!kwRecommendationsResponse.ok) {
                  throw new Error(`Keyword Recommendations API Error for ${keyword}: ${kwRecommendationsResponse.status} ${kwRecommendationsResponse.statusText}`);
                }

                const kwRecommendationsData = await kwRecommendationsResponse.json();
                console.log(`Keyword Recommendations API Response for ${keyword}:`, kwRecommendationsData);

                //Modified here to pass the recommendation container ID
                //displayKeywordRecommendations(kwRecommendationsData.body, recommendationsContainerId);

                // Extract URL
                let mapped_url = null;

                // Make sure the recommendation data is not null
                if (kwRecommendationsData.body) {
                  try {
                    const urlMatch = kwRecommendationsData.body.match(/(https?:\/\/|www\.)([a-zA-Z0-9.-]+(\.[a-zA-Z]{2,})+[a-zA-Z0-9_/\-\?=\&%\#\.]*)/gi);
                    if (urlMatch && urlMatch.length > 0) {
                      mapped_url = urlMatch[0];
                    } else {
                      console.warn(`No URL found in recommendations for ${keyword}`);
                      mapped_url = 'N/A'; // Set to N/A if no URL is found
                    }
                  } catch (urlExtractionError) {
                    console.error(`Error extracting URL from recommendations for ${keyword}:`, urlExtractionError);
                    mapped_url = 'N/A';  // Set to N/A in case of an error during extraction
                  }
                } else {
                  console.warn(`Empty keyword recommendations for ${keyword}`);
                  mapped_url = 'N/A';  // Set to N/A if the recommendations are empty
                }


                // Extract Time to Rank using regex
                const timeToRankMatch = kwRecommendationsData.body.match(/(0-3 months|3-6 months|6-9 months|9-12 months|more than 12 months|More than 12 months)/);
                const timeToRank = timeToRankMatch ? timeToRankMatch[0] : 'N/A';
                return [timeToRank, mapped_url];
              } else {
                console.warn(`Skipping Keyword Recommendations for ${keyword} due to missing serp_dict.`);
                return ['N/A', 'N/A'];
              }
            } else {
              console.warn(`Invalid Keyword Mapping API response format for ${keyword}. Expected 'body' as array.`);
              return ['N/A', 'N/A'];
            }

          } catch (error) {
            console.error(`Error during Keyword Mapping, Target Content Processing, or Keyword Recommendations for ${keyword}:`, error);
            return ['N/A', 'N/A'];
          }
        }

        async function getDomainMetrics(url, keyword) {
          const domainMetricsEndpoint = 'https://5zdbpwaia5.execute-api.ap-southeast-1.amazonaws.com/pageDomainMetrics';

          try {
            const response = await fetch(domainMetricsEndpoint, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                url: url,
                keyword: keyword
              })
            });

            if (!response.ok) {
              console.warn(`Domain Metrics API Error for URL ${url}: ${response.status} ${response.statusText}`);
              return null;
            }

            const data = await response.json();
            return data;
          } catch (error) {
            console.error(`Error fetching domain metrics for URL ${url}:`, error);
            return null;
          }
        }

        async function getKeywordRankings() {
          const country = document.getElementById('keywordAnalysisCountry').value;
          const language = document.getElementById('keywordAnalysisLanguage').value;
          const keywords = document.getElementById('keyword_analysis_keywords').value.split(/[\n,]+/).map(k => k.trim()).filter(Boolean);
          const domain = document.getElementById('keyword_analysis_url').value;
          const table = document.getElementById('queriedKeywordsTable').getElementsByTagName('tbody')[0];
          table.innerHTML = ''; // Clear existing table data

          let rowNumber = 1; // Initialize the row number counter

          for (const keyword of keywords) { //Iterate keywords sequentially
            const data = await fetchRank(domain, country, language, keyword); //Fetch rank for each keyword

            if (data && Object.keys(data).length > 0) {
              for (const rank in data) {
                if (data.hasOwnProperty(rank)) {
                  const url = data[rank].url;
                  const newRow = table.insertRow();
                  const cell1 = newRow.insertCell(0);
                  const cell2 = newRow.insertCell(1);
                  const cell3 = newRow.insertCell(2);
                  const cell4 = newRow.insertCell(3);

                  cell1.innerHTML = rowNumber;
                  cell2.innerHTML = keyword;
                  cell3.innerHTML = rank;
                  cell4.innerHTML = `<a href="${url}" target="_blank">${url}</a>`;
                }
              }
              rowNumber++; // Increment the row number after displaying all entries for a keyword
            } else {
              // Handle case where no results are found for a keyword
              const newRow = table.insertRow();
              const cell1 = newRow.insertCell(0);
              const cell2 = newRow.insertCell(1);
              const cell3 = newRow.insertCell(2);
              const cell4 = newRow.insertCell(3);

              cell1.innerHTML = rowNumber;
              cell2.innerHTML = keyword;
              cell3.innerHTML = 'Not Found';
              cell4.innerHTML = 'Not Found';
              rowNumber++; // Increment the row number even when no results are found
            }
          }
          document.getElementById('queriedKeywordsCard').style.display = "block";
        }

        async function getSimilarKeywords() {
          const country = document.getElementById('keywordAnalysisCountry').value;
          const language = document.getElementById('keywordAnalysisLanguage').value;
          const keywords = document.getElementById('keyword_analysis_keywords').value.split(/[\n,]+/).map(k => k.trim()).filter(Boolean);


          var url = "https://lgvdhcs4t2.execute-api.ap-southeast-1.amazonaws.com/similarKeywords";
          var queryString = {
            "keywords": keywords,
            "location": country,
            "language": language
            ,//"user": JSON.parse(localStorage.getItem('googleUser')).email
          };

          var headers = {
            "Content-Type": "application/json",
          };

          try {
            const response = await fetch(url, {
              method: 'POST',
              headers: headers,
              body: JSON.stringify(queryString)
            });

            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            const data = await response.json();
            populateSimilarKeywordsTable(data.body);
          } catch (error) {
            console.error("Error fetching data:", error);
            // Re-throw the error to signal failure to the caller (keywordAnalysis)
            throw error;
          }
        }

        async function getRankingKeywords() {
          const domain = document.getElementById('keyword_analysis_url').value;
          const country = document.getElementById('keywordAnalysisCountry').value;
          let targetDomain = domain;

          console.log("keywordAnalysisTypeDomain is checked:", document.getElementById('keywordAnalysisTypeDomain').checked);

          if (document.getElementById('keywordAnalysisTypeDomain').checked) {
            if (targetDomain.includes('http')) {
              targetDomain = (targetDomain.replace('http://', '').replace('https://', '')).split('/')[0];
              console.log("Extracted domain:", targetDomain);
            }
          } else {
            if (!targetDomain.includes('http')) {
              targetDomain = 'https://' + targetDomain;
            }
          }

          const url = "https://0dqny7l5y9.execute-api.ap-southeast-1.amazonaws.com/rankingKeywords";

          const headers = {
            "Content-Type": "application/json",
          };

          const queryString = {
            "target": targetDomain,
            "location": country
          };

          try {
            const response = await fetch(url, {
              method: 'POST',
              headers: headers,
              body: JSON.stringify(queryString)
            });

            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            const data = await response.json();
            populateRankingKeywordsTable(data.body);
            addTableEventListeners();
          } catch (error) {
            console.error("Error fetching data:", error);
            // Re-throw the error to signal failure to the caller (keywordAnalysis)
            throw error;
          }
        }

        async function getWebpageKeywords() {
          const domain = document.getElementById('keyword_analysis_url').value;
          const country = document.getElementById('keywordAnalysisCountry').value;
          const language = document.getElementById('keywordAnalysisLanguage').value;

          const endpoint = "https://ei6xj9x2rd.execute-api.ap-southeast-1.amazonaws.com/keywordsForSite";
          try {
            const response = await fetch(endpoint, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                location: country,
                language: language,
                target: domain
              })
            });

            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            if (typeof data !== 'object' || data === null) {
              console.error("Data is not an object:", data);
              return; // Exit function if data is not an object.
            }
            const allKeywords = Object.entries(data).map(([keyword, values]) => ({
              keyword,
              search_volume: values.search_volume,
              competition: values.competition,
              search_intent: values.search_intent,
              reason_for_choosing: values.reason_for_choosing
            }));

            populateWebpageKeywordsTable(allKeywords);
          } catch (error) {
            console.error("Error fetching data:", error);
            // Re-throw the error to signal failure to the caller (keywordAnalysis)
            throw error;
          }
        }

        function populateWebpageKeywordsTable(keywords) {
          const tableBody = document.querySelector("#webpageKeywordsTable tbody");

          //Clear existing table rows
          tableBody.innerHTML = "";

          //Iterate through the keywords and create table rows
          keywords.forEach(keyword => {
            const row = tableBody.insertRow();
            const keywordCell = row.insertCell();
            const searchVolCell = row.insertCell();
            const competitionCell = row.insertCell();
            const searchIntentCell = row.insertCell();
            const reasonCell = row.insertCell();
            const addCell = row.insertCell();

            keywordCell.textContent = keyword.keyword;
            searchVolCell.textContent = keyword.search_volume;
            competitionCell.textContent = keyword.competition;
            searchIntentCell.textContent = keyword.search_intent;
            reasonCell.textContent = keyword.reason_for_choosing;

            // Create the + icon with a class for styling and a click handler
            const plusIcon = document.createElement("i");
            plusIcon.classList.add("fas", "fa-plus-circle", "clickable-plus");
            plusIcon.addEventListener("click", () => {
              addKeywordToTextarea(keyword.keyword);
              addCell.textContent = "added";
            });
            addCell.appendChild(plusIcon);
          });
          makeTableSortable('webpageKeywordsTable');
        }

        function populateSimilarKeywordsTable(keywords) {
          const tableBody = document.querySelector("#similarKeywordsTable tbody");

          //Clear existing table rows
          tableBody.innerHTML = "";

          const similarKeywordsArray = Object.entries(keywords).map(([keyword, data]) => ({
            keyword: keyword,
            search_volume: data.search_volume,
            cpc: data.cpc,
            competition: data.competition
          }));

          //Iterate through the keywords and create table rows
          similarKeywordsArray.forEach(keyword => {
            const row = tableBody.insertRow();
            const keywordCell = row.insertCell();
            const searchVolCell = row.insertCell();
            const competitionCell = row.insertCell();
            const cpcCell = row.insertCell();
            const addCell = row.insertCell();

            keywordCell.textContent = keyword.keyword;
            searchVolCell.textContent = keyword.search_volume;
            competitionCell.textContent = keyword.competition;
            cpcCell.textContent = keyword.cpc;

            // Create the + icon with a class for styling and a click handler
            const plusIcon = document.createElement("i");
            plusIcon.classList.add("fas", "fa-plus-circle", "clickable-plus");
            plusIcon.addEventListener("click", () => {
              addKeywordToTextarea(keyword.keyword);
              addCell.textContent = "added";
            });
            addCell.appendChild(plusIcon);
          });
          makeTableSortable('similarKeywordsTable');
        }

        function populateRankingKeywordsTable(keywords) {
          const tableBody = document.querySelector("#rankingKeywordsTable tbody");

          //Clear existing table rows
          tableBody.innerHTML = "";

          const rankedKeywordsArray = Object.entries(keywords).map(([keyword, data]) => ({
            keyword: keyword,
            search_volume: data.search_volume,
            rank: data.rank,
            difficulty: data.difficulty,
            cpc: data.cpc
          }));

          //Iterate through the keywords and create table rows
          rankedKeywordsArray.forEach(keyword => {
            const row = tableBody.insertRow();
            const keywordCell = row.insertCell();
            const searchVolCell = row.insertCell();
            const rankCell = row.insertCell();
            const cpcCell = row.insertCell();
            const addCell = row.insertCell();

            keywordCell.textContent = keyword.keyword;
            searchVolCell.textContent = keyword.search_volume;
            rankCell.textContent = keyword.rank;
            cpcCell.textContent = keyword.cpc;

            // Create the + icon with a class for styling and a click handler
            const plusIcon = document.createElement("i");
            plusIcon.classList.add("fas", "fa-plus-circle", "clickable-plus");
            plusIcon.addEventListener("click", () => {
              addKeywordToTextarea(keyword.keyword);
              addCell.textContent = "added";
            });
            addCell.appendChild(plusIcon);
          });
          makeTableSortable('rankingKeywordsTable');
          document.getElementById('combinedCards').style.display = "block";
          document.getElementById('serpCard').style.display
        }



        function addKeywordToTextarea(keyword) {
          const textarea = document.getElementById('keyword_analysis_keywords');
          const existingKeywords = textarea.value.split(/[\n,]+/).map(k => k.trim()).filter(Boolean);

          if (!existingKeywords.includes(keyword)) {
            if (existingKeywords.length > 0) {
              textarea.value += "\n";
            }
            textarea.value += keyword + "\n";
            updateKeywordCount();
          } else {
            console.log(`Keyword "${keyword}" already exists in textarea. Skipping.`);
          }
        }

        function updateKeywordCount() {
          const textarea = document.getElementById('keyword_analysis_keywords');
          const keywords = textarea.value.split(/[\n,]+/).map(k => k.trim()).filter(Boolean);
          const keywordCount = keywords.length;
          const countDisplayElement = document.getElementById('keywordCountDisplay');

          if (keywordCount == 0) {
            countDisplayElement.textContent = 'Keywords';
          } else {
            countDisplayElement.textContent = `Keyword Count: ${keywordCount}`;
          }
        }

        function sortTable(tableId, columnIndex, isNumeric = false) {
          const table = document.getElementById(tableId);
          const tbody = table.querySelector('tbody');
          const rows = Array.from(tbody.querySelectorAll('tr'));

          // Get the current sort direction from the table's dataset
          const currentSortDirection = table.dataset.sortDirection === 'asc' ? 'asc' : 'desc';

          const comparer = (row1, row2) => {
            const cell1 = row1.querySelectorAll('td')[columnIndex].textContent.trim();
            const cell2 = row2.querySelectorAll('td')[columnIndex].textContent.trim();

            let comparison = 0; // Default comparison value

            if (isNumeric) {
              const num1 = parseFloat(cell1);
              const num2 = parseFloat(cell2);

              if (isNaN(num1) && isNaN(num2)) comparison = 0;
              else if (isNaN(num1)) comparison = 1;
              else if (isNaN(num2)) comparison = -1;
              else comparison = num1 - num2;
            } else {
              comparison = cell1.localeCompare(cell2);
            }

            // Reverse the comparison based on the current sort direction
            return currentSortDirection === 'asc' ? comparison : -comparison;
          };

          rows.sort(comparer);

          // Remove existing rows from the table
          while (tbody.firstChild) {
            tbody.removeChild(tbody.firstChild);
          }

          // Append sorted rows to the table
          rows.forEach(row => tbody.appendChild(row));

          // Update the sort direction for the next click
          table.dataset.sortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
        }


        function makeTableSortable(tableId) {
          const table = document.getElementById(tableId);
          const thead = table.querySelector('thead');
          const headers = thead.querySelectorAll('th');

          headers.forEach((header, columnIndex) => {
            const isNumericColumn = (header.textContent.toLowerCase().includes("search vol") || header.textContent.toLowerCase().includes("cpc") || header.textContent.toLowerCase().includes("rank"));

            header.addEventListener('click', () => {
              sortTable(tableId, columnIndex, isNumericColumn);
            });
            header.style.cursor = 'pointer';
          });

          // Initialize sort direction for the table (ascending by default)
          table.dataset.sortDirection = 'asc';
        }

        function attachKeywordTableListeners(tableId) {
          const table = document.getElementById(tableId);
          if (!table) {
            console.warn(`Table with ID "${tableId}" not found.`);
            return;
          }

          const tableBody = table.querySelector('tbody');
          if (!tableBody) {
            console.warn(`Table with ID "${tableId}" has no tbody.`);
            return;
          }

          tableBody.addEventListener('click', function (event) {
            // Find the closest row element (<tr>) to the clicked element
            const targetRow = event.target.closest('tr');

            if (targetRow) {
              // Get the keyword from the first cell (<td>) of the row
              const keywordCell = targetRow.querySelector('td:first-child');

              if (keywordCell) {
                const keyword = keywordCell.textContent;
                console.log(`Clicked keyword: ${keyword}`); // For debugging
                showSerps(keyword); // Call your showSerps function
              }
            }
          });
        }

        function addTableEventListeners() {
          const rakedKeywordsTable = document.getElementById('rankingKeywordsTable');
          const similarKeywordsTable = document.getElementById('similarKeywordsTable');
          const webpageKeywordsTable = document.getElementById('webpageKeywordsTable');

          if (rakedKeywordsTable) {
            rakedKeywordsTable.addEventListener('click', function (event) {
              if (event.target.tagName === 'TD') {
                const keyword = event.target.parentElement.cells[0].textContent;
                serpModal(keyword);
              }
            });
          }

          if (similarKeywordsTable) {
            similarKeywordsTable.addEventListener('click', function (event) {
              if (event.target.tagName === 'TD') {
                const keyword = event.target.parentElement.cells[0].textContent;
                serpModal(keyword);
              }
            });
          }

          if (webpageKeywordsTable) {
            webpageKeywordsTable.addEventListener('click', function (event) {
              if (event.target.tagName === 'TD') {
                const keyword = event.target.parentElement.cells[0].textContent;
                serpModal(keyword);
              }
            });
          }
        }

        async function mapKeywords() {
          if (!document.getElementById('keyword_analysis_keywords').value || !document.getElementById('keyword_analysis_url').value) {
            document.getElementById('keywordAnalysisUrlHelp').style.display = "block";
            document.getElementById('keywordAnalysisUrlDiv').classList.add('has-error', 'has-feedback');
            document.getElementById('keywordAnalysisKeywordsHelp').style.display = "block";
            document.getElementById('keywordAnalysisKeywordsDiv').classList.add('has-error', 'has-feedback');
            return
          }

          document.getElementById('mapKeywordsBtn').innerHTML = '<div class="custom-toggle rotate"><i class="icon-settings"></i></div>';
          const promises = [];

          promises.push(getKeywordRankings());
          await Promise.all(promises);

          const domain = document.getElementById('keyword_analysis_url').value;
          const country = document.getElementById('keywordAnalysisCountry').value;
          const language = document.getElementById('keywordAnalysisLanguage').value;
          const keywords = document.getElementById('keyword_analysis_keywords').value.split(/[\n,]+/).map(k => k.trim()).filter(Boolean);

          // Clear the existing mapping
          keywordMapping = {};
          clearAllLists(); //remove all the lists
          listCounter = 1; //restart the list counter

          // Create an array to hold the promises for each fetch request
          const fetchPromises = keywords.map(keyword => {
            return fetch('https://6s7ijwwsa8.execute-api.ap-southeast-1.amazonaws.com/dragDrop', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                domain: domain,
                keyword: keyword,
                language: language,
                location: country,
              })
            }).then(response => {
              if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
              }
              return response.json();
            }).then(data => {
              data = data.replace(domain, '').replace('http://', '').replace('www.', '').replace('https://', '');
              // Use the API response URL as the key in your mapping
              if (data) {
                if (!keywordMapping[data]) {
                  keywordMapping[data] = [];
                }
                keywordMapping[data].push(keyword); // Map keyword to URL
              } else {
                console.warn(`API response missing URL for keyword: ${keyword}`);
              }
            })
              .catch(error => {
                console.error(`Error for keyword "${keyword}":`, error);
              });
          });

          try {
            // Wait for all promises to resolve before populating the lists
            await Promise.all(fetchPromises);

            // Now populate the lists based on the built-up keywordMapping
            populateListsFromMapping();
          } catch (error) {
            console.error("An error occurred during the fetch requests:", error);
          } finally {
            document.getElementById('mapKeywordsBtn').innerHTML = 'Map Keywords';
          }
        }

        function populateListsFromMapping() {
          for (const url in keywordMapping) {
            if (keywordMapping.hasOwnProperty(url)) {
              const { listContainer, list, renameInput } = createListContainer(url);

              keywordMapping[url].forEach(keyword => {
                const listItem = createKeywordListItem(keyword);
                list.appendChild(listItem);
              });

              listsContainer.appendChild(listContainer);
              listCounter++;
            }
          }
        }

        function createKeywordListItem(keyword) {
          const listItem = document.createElement('li');
          listItem.draggable = true;
          listItem.addEventListener('dragstart', drag);
          listItem.id = keyword;
          listItem.textContent = keyword; // Display keyword
          return listItem;
        }

        function createListContainer(url) {
          const listContainer = document.createElement('div');
          listContainer.classList.add('list-container');

          const renameInput = document.createElement('input');
          renameInput.type = 'text';
          renameInput.classList.add('border', 'rounded', 'p-2', 'flex-grow-1', 'me-2');
          renameInput.value = url;

          // Add event listener for renameList
          renameInput.addEventListener('blur', function () {
            renameList(this);
          });

          const deleteButton = document.createElement('button');
          deleteButton.classList.add('btn', 'btn-sm', 'btn-outline-danger');
          deleteButton.innerHTML = '<i class="fas fa-times"</i>';
          deleteButton.addEventListener('click', function () {
            deleteList(this);
          });


          const listId = 'list' + listCounter;
          const list = document.createElement('ul');
          list.id = listId;
          list.classList.add('keyword-list');
          list.addEventListener('drop', drop);
          list.addEventListener('dragover', allowDrop);

          listContainer.appendChild(renameInput);
          listContainer.appendChild(deleteButton);
          listContainer.appendChild(list);

          // Add the "Page Recommendations" button
          const recommendationsButton = document.createElement('button');
          recommendationsButton.classList.add("btn", "btn-primary", "w-100");
          recommendationsButton.style.display = "block";
          domain = document.getElementById('keyword_analysis_url').value;
          recommendationsButton.innerHTML += '<i class="fas fa-magic me-1"></i> ';
          recommendationsButton.textContent = 'Page Recommendations';
          recommendationsButton.addEventListener('click', function () {
            // Disable the button
            this.disabled = true;
            this.classList.add('disabled');

            // Get the URL from the input field *inside* this function
            const currentURL = domain + renameInput.value;

            console.log(currentURL);

            // Get the list items and put them into an array
            const listItems = Array.from(list.children).map(item => item.textContent.trim());

            getPageRecommendations(currentURL, listItems, this); // Pass the button element
          });
          listContainer.appendChild(recommendationsButton);
          return { listContainer, list, renameInput };
        }

        async function getPageRecommendations(url, listElement, button) {
          button.innerHTML = '<div class="custom-toggle rotate"><i class="icon-settings"></i></div>';
          const recommendationEndpoint = 'https://pkkz2e02ch.execute-api.ap-southeast-1.amazonaws.com/onPageContentRecommendations';

          try {
            const recommendationResponse = await fetch(recommendationEndpoint, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                url,
                "keywords": listElement
              })
            });

            recommendationData = await recommendationResponse.json();

            // Create collapsible structure
            const collapsibleButton = document.createElement('button');
            collapsibleButton.classList.add('collapsible50');
            collapsibleButton.textContent = `${url}`;

            const contentDiv = document.createElement('div');
            contentDiv.classList.add('content');

            // Check if the response is a list of dictionaries
            if (Array.isArray(recommendationData) && recommendationData.length > 0 && typeof recommendationData[0] === 'object') {
              // Create a table
              const table = document.createElement('table');
              table.classList.add("table", "table-striped", "mt-3");

              // Create table header
              const thead = document.createElement('thead');
              const headerRow = document.createElement('tr');
              const headers = Object.keys(recommendationData[0]);

              headers.forEach(headerText => {
                const th = document.createElement('th');
                th.textContent = headerText;
                th.style.border = '1px solid #ddd';
                th.style.padding = '8px';
                th.style.textAlign = 'left';
                headerRow.appendChild(th);
              });
              thead.appendChild(headerRow);
              table.appendChild(thead);


              // Create table body
              const tbody = document.createElement('tbody');
              recommendationData.forEach(item => {
                const row = document.createElement('tr');
                headers.forEach(header => {
                  const cell = document.createElement('td');
                  cell.textContent = item[header];
                  cell.style.border = '1px solid #ddd';
                  cell.style.padding = '8px';
                  row.appendChild(cell);
                });
                tbody.appendChild(row);
              });
              table.appendChild(tbody);

              contentDiv.innerHTML += '<h3>Content Optimisation</h3>';

              contentDiv.appendChild(table); // Append the table to the content div

              endpoint = 'https://udjdc333m9.execute-api.ap-southeast-1.amazonaws.com/getImages';

              response = await fetch(endpoint, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  url: url,
                  keywords: listElement // Send keywords to the backend
                })
              });

              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }

              data = await response.json();

              console.log(data);

              const recommendationEndpoint = 'https://vwmqqj251d.execute-api.ap-southeast-1.amazonaws.com/onPageRecommendations';

              const recommendationResponse = await fetch(recommendationEndpoint, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  "data": data,
                  "keywords": listElement
                })
              });

              if (!recommendationResponse.ok) {
                throw new Error(`HTTP error! status: ${recommendationResponse.status}`);
              }

              recommendationData = await recommendationResponse.json();

              data = recommendationData;
              let resultsHTML = '';

              let metaTableHTML = `<h3>Meta and Headings</h3>
        <table id="metaTable" class="table table-striped mt-3">
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Current Value</th>
                    <th>Suggested Change</th>
                    <th>Rationale</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Meta Title</td>
                    <td>${data.meta_title.current_value}</td>
                    <td><textarea class="form-control">${data.meta_title.suggested_value}</textarea></td>
                    <td>${data.meta_title.rationale}</td>
                </tr>
                <tr>
                    <td>Meta Description</td>
                    <td>${data.meta_description.current_value}</td>
                    <td><textarea class="form-control">${data.meta_description.suggested_value}</textarea></td>
                    <td>${data.meta_description.rationale}</td>
                </tr>
                <tr>
                    <td>Canonical URL</td>
                    <td>${data.canonical_url.current_value}</td>
                    <td><textarea class="form-control">${data.canonical_url.suggested_value}</textarea></td>
                    <td>${data.canonical_url.rationale}</td>
                </tr>`;

              // Function to add heading rows
              function addHeadingRows(headingType, headings) {
                headings.forEach(heading => {
                  metaTableHTML += `
                <tr>
                    <td>${headingType}</td>
                    <td>${heading.current_value}</td>
                    <td><textarea class="form-control">${heading.suggested_value}</textarea></td>
                    <td>${heading.rationale}</td>
                </tr>
            `;
                });
              }

              addHeadingRows("H1 Heading", data.headings.h1);
              addHeadingRows("H2 Heading", data.headings.h2);
              addHeadingRows("H3 Heading", data.headings.h3);
              addHeadingRows("H4 Heading", data.headings.h4);

              metaTableHTML += `

            </tbody>
        </table>
    `;

              let imageTableHTML = `<h3>Image Title and Alt Text</h3>
            <table id="imageTable" class="table table-striped mt-3">
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>Image URL</th>
                        <th>Image Preview</th>
                        <th>Alt Text</th>
                        <th>Suggested Alt Text</th>
                        <th>Rationale</th>
                    </tr>
                </thead>
                <tbody>
        `;

              let i = 0;
              for (const imageData of data.image_data) {
                const imageUrl = Object.keys(imageData)[0];
                const imageDetails = imageData[imageUrl];

                imageTableHTML += `
                <tr>
                    <td>${i + 1}</td>
                    <td><a href="${imageUrl}" target="_blank">${imageUrl}</a></td>
                    <td><img style="width:200px;" src="${imageUrl}" alt="${imageDetails.current_value}"></td>
                    <td>${imageDetails.current_value}</td>
                    <td><textarea class="form-control">${imageDetails.suggested_value}</textarea></td>
                    <td>${imageDetails.rationale}</td>
                </tr>
            `;
                i++;
              }


              imageTableHTML += `
                </tbody>
            </table>
        `;

              resultsHTML += metaTableHTML;

              // Add export button after image table
              resultsHTML += '<button class="btn btn-black" onclick="exportOnPageToCSV()">Export to CSV</button>';

              contentDiv.innerHTML += resultsHTML;
              contentDiv.innerHTML += imageTableHTML;

            } else {
              // If it's not a list of dictionaries, just set the innerHTML
              contentDiv.innerHTML = recommendationData;
            }


            // Append elements to the recommendations div
            const recommendationsDiv = document.getElementById('onPageRecommendations');
            recommendationsDiv.appendChild(collapsibleButton);
            recommendationsDiv.appendChild(contentDiv);

            // Add event listener for collapsible functionality
            collapsibleButton.addEventListener('click', function () {
              this.classList.toggle('active');
              const content = this.nextElementSibling;
              if (content.style.display === 'block') {
                content.style.display = 'none';
              } else {
                content.style.display = 'block';
              }
            });

            console.log(recommendationData); // Now logs the parsed JSON data

          } catch (error) {
            console.error("Error fetching recommendations:", error);
          } finally {
            // Re-enable the button in the finally block to ensure it always happens
            button.disabled = false;
            button.classList.remove('disabled');
            button.innerHTML = "Page Recommendations";
          }
        }

        function exportOnPageToCSV() {
          // Collect data from both tables
          const metaTable = document.getElementById('metaTable');
          const imageTable = document.getElementById('imageTable');
          const contentTable = document.getElementById('contentTable');


          if (!metaTable || !imageTable) {
            alert('Tables not found. Please extract data first.');
            return;
          }

          const metaData = tableToCSV(metaTable);
          const imageData = tableToCSV(imageTable);
          const contentData = tableToCSV(contentTable);

          // Combine the data with a separator
          const csvData = "Meta Table Data:\n" + metaData + "\n\nImage Table Data:\n" + imageData + "\n\nContent Recommendations:\n" + contentData;

          // Create a download link
          const filename = 'on_page_recommendations.csv';
          const csvFile = new Blob([csvData], {
            type: 'text/csv'
          });
          const downloadLink = document.createElement('a');
          downloadLink.download = filename;
          downloadLink.href = window.URL.createObjectURL(csvFile);
          downloadLink.style.display = 'none';
          document.body.appendChild(downloadLink);
          downloadLink.click();
          document.body.removeChild(downloadLink);
        }

        function allowDrop(ev) {
          ev.preventDefault();
          const target = ev.target;

          if (target.classList.contains('keyword-list')) {
            // Check if the list is full
            if (target.children.length < MAX_ITEMS_PER_LIST) {
              target.classList.add('drag-over');
            } else {
              // Optional: Provide visual feedback that the list is full
              target.classList.add('list-full'); // Add a class for styling, e.g., red border
            }
          }
        }

        function clearAllLists() {
          while (listsContainer.firstChild) {
            listsContainer.removeChild(listsContainer.firstChild);
          }
        }

        function drop(ev) {
          ev.preventDefault();
          const target = ev.target;

          if (target.classList.contains('keyword-list')) {
            target.classList.remove('drag-over'); // Always remove the drag-over class

            // Check if the list is full again before dropping (safety check)
            if (target.children.length < MAX_ITEMS_PER_LIST) {
              var data = ev.dataTransfer.getData("text");
              var draggedElement = document.getElementById(data);
              target.appendChild(draggedElement);

              // Increase the height of the list
              const currentHeight = parseInt(window.getComputedStyle(target).minHeight);
              const numberOfKeywords = target.children.length;
              const heightIncrease = (numberOfKeywords * HEIGHT_PER_KEYWORD);
              target.style.minHeight = (currentHeight + heightIncrease) + 'px';

              target.classList.remove('list-full'); // remove the list-full class if there are items to drop
            } else {
              //Optional: Prevent the drop from occurring
              //You can optionally add additional error handling here
              target.classList.remove('list-full');
              return;
            }

          } else {
            target.classList.remove('drag-over');
            target.classList.remove('list-full'); //also, prevent adding css if element does not have the correct class
          }
        }

        function drag(ev) {
          ev.dataTransfer.setData("text", ev.target.id);
        }

        const MAX_ITEMS_PER_LIST = 20; // Set the maximum limit
        const HEIGHT_PER_KEYWORD = 6; // Additional increase per keyword.

        function deleteList(deleteButton) {
          const listContainer = deleteButton.parentNode;
          const listsContainer = document.getElementById('listsContainer');

          // Store the deleted list details for undo
          deletedLists.push({
            element: listContainer,
            nextSibling: listContainer.nextSibling,
            listsContainer: listsContainer
          });

          listsContainer.removeChild(listContainer);

          // Enable the undo button if there are no more deleted lists
          undoBtn.disabled = deletedLists.length === 0;
        }

        function addNewList() {
          const listsContainer = document.getElementById('listsContainer');

          const listContainer = document.createElement('div');
          listContainer.classList.add('list-container');

          const listId = 'list' + listCounter;
          const defaultName = '/url-' + listCounter;

          const renameInput = document.createElement('input');
          renameInput.type = 'text';
          renameInput.classList.add('border', 'rounded', 'p-2', 'flex-grow-1', 'me-2');
          renameInput.value = defaultName;

          // Add event listener for renameList
          renameInput.addEventListener('blur', function () {
            renameList(this);
          });


          const deleteButton = document.createElement('button');
          deleteButton.classList.add('btn', 'btn-sm', 'btn-outline-danger');
          deleteButton.innerHTML = '<i class="fas fa-times"</i>';
          deleteButton.addEventListener('click', function () {
            deleteList(this);
          });

          const list = document.createElement('ul');
          list.id = listId;
          list.classList.add('keyword-list');
          list.addEventListener('drop', drop);
          list.addEventListener('dragover', allowDrop);

          listContainer.appendChild(renameInput);
          listContainer.appendChild(deleteButton);
          listContainer.appendChild(list);

          // Add the "Page Recommendations" button
          const recommendationsButton = document.createElement('button');
          recommendationsButton.classList.add("btn", "btn-primary", "w-100");
          recommendationsButton.style.display = "block";
          recommendationsButton.innerHTML += '<i class="fas fa-magic me-1"></i> ';
          recommendationsButton.textContent = 'Page Recommendations';
          recommendationsButton.addEventListener('click', function () {
            // Disable the button
            this.disabled = true;
            this.classList.add('disabled');

            const url = renameInput.value; //get the url value

            // Get the list items and put them into an array
            const listItems = Array.from(list.children).map(item => item.textContent.trim());

            console.log(listItems);

            getPageRecommendations(url, listItems, this); // Pass both URL and the array of list items and the button element
          });
          listContainer.appendChild(recommendationsButton);

          listsContainer.appendChild(listContainer);

          listCounter++;
        }

        let listCounter = 1;
        let deletedLists = []; // Store an array of deleted lists for multiple undo

        function deleteList(deleteButton) {
          const listContainer = deleteButton.parentNode;
          const listsContainer = document.getElementById('listsContainer');

          // Store the deleted list details for undo
          deletedLists.push({
            element: listContainer,
            nextSibling: listContainer.nextSibling,
            listsContainer: listsContainer
          });

          listsContainer.removeChild(listContainer);

          // Enable the undo button if there are no more deleted lists
          undoBtn.disabled = deletedLists.length === 0;
        }

        function undoDelete() {
          if (deletedLists.length > 0) {
            const lastDeleted = deletedLists.pop(); // Get the last deleted list

            // Re-insert the deleted list
            if (lastDeleted.nextSibling) {
              lastDeleted.listsContainer.insertBefore(lastDeleted.element, lastDeleted.nextSibling);
            } else {
              lastDeleted.listsContainer.appendChild(lastDeleted.element);
            }

            // Disable the undo button if there are no more deleted lists
            undoBtn.disabled = deletedLists.length === 0;
          }
        }

        async function fetchRank(domain, country, language, keyword) {
          try {
            const response = await fetch('https://w9opnioy78.execute-api.ap-southeast-1.amazonaws.com/checkRankingUrl', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                "keyword": keyword,
                "language": language,
                "location": country,
                "target": domain
              })
            });

            if (!response.ok) {
              throw new Error(`HTTP error ${response.status}`);
            }

            data = await response.json();

            return data
          } catch (error) {
            console.error("Error fetching rank:", error);
            return ('not available');
          }
        }


      </script>

      <style>
        .containerForMapping {
          display: flex;
          flex-wrap: wrap;
          justify-content: space-around;
        }

        .list-container {
          width: 300px;
          margin: 10px;
          background-color: #fff;
          border: 1px solid #ccc;
          border-radius: 15px;
          padding: 10px;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
          position: relative;
        }

        .keyword-list {
          list-style: none;
          padding: 0;
          margin: 0;
          min-height: 200px;
          /* Starting height */
        }

        .keyword-list li {
          background-color: #eee;
          border: 1px solid #ddd;
          padding: 8px 12px;
          margin: 10px;
          cursor: grab;
          border-radius: 20px;
          user-select: none;
        }

        .keyword-list li:hover {
          background-color: #ddd;
        }

        .keyword-list.drag-over {
          background-color: #f9f9f9;
          border: 2px dashed #aaa;
        }

        .rotate {
          animation: rotate-clockwise-animation 2s linear infinite;
          display: inline-block;
          /* Important for transform to work */
        }

        .collapsible50 {
          border-radius: 20px;
          background: rgba(222, 222, 222, .4);
          color: #585c5d;
          margin-top: 5px;
          margin-bottom: 5px;
          padding: 10px 20px;
          border: none;
          margin: 5px;
        }

        .collapsible50:active {
          background: #6861ce;
          color: white;
        }

        @keyframes rotate-clockwise-animation {
          0% {
            transform: rotate(0deg);
          }

          100% {
            transform: rotate(360deg);
          }
        }
      </style>

      <div class="container">
        <div class="page-inner">
          <div class="page-header">
            <h3 class="fw-bold mb-3">Keyword Analysis</h3>
          </div>
          <div class="row">
            <div class="card">
              <div class="card-header">
                <div class="card-title">Client Information</div>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <div id="keywordAnalysisUrlDiv" class="form-group">
                      <label for="text">URL</label>
                      <input type="text" class="form-control" id="keyword_analysis_url" placeholder="Enter URL" />
                      <small id="keywordAnalysisUrlHelp" class="form-text text-muted" style="display:none;">Either key
                        in a URL / domain and/or keywords to proceed.</small>
                    </div>
                    <div class="form-group">
                      <label class="form-label">Analysis Type</label>
                      <div class="selectgroup w-100">
                        <label class="selectgroup-item">
                          <input type="radio" name="keywordAnalysisType" value="domain" class="selectgroup-input"
                            id="keywordAnalysisTypeDomain" checked />
                          <span class="selectgroup-button">Domain</span>
                        </label>
                        <label class="selectgroup-item">
                          <input type="radio" name="keywordAnalysisType" value="webpage" class="selectgroup-input"
                            id="keywordAnalysisTypeWebpage" />
                          <span class="selectgroup-button">Webpage</span>
                        </label>
                      </div>
                      <div class="row">
                        <div class="col-md-6">
                          <div class="form-group">
                            <label for="keywordAnalysisCountry">Country</label>
                            <select class="form-select form-control-sm" id="keywordAnalysisCountry">
                              <option value="Singapore">Singapore</option>
                              <option value="None">Global</option>
                              <option value="Australia">Australia</option>
                              <option value="Bhutan">Bhutan</option>
                              <option value="Brazil">Brazil</option>
                              <option value="Canada">Canada</option>
                            </select>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="form-group">
                            <label for="keywordAnalysisLanguage">Language</label>
                            <select class="form-select form-control-sm" id="keywordAnalysisLanguage">
                              <option value="English">English</option>
                              <option value="Arabic">Arabic</option>
                              <option value="Chinese (Simplified)">Chinese (Simplified)</option>
                              <option value="Chinese (Traditional)">Chinese (Traditional)</option>
                            </select>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group" id="keywordAnalysisKeywordsDiv">
                      <label for="comment" id="keywordCountDisplay">Keywords</label>
                      <textarea class="form-control" id="keyword_analysis_keywords" rows="5"></textarea>
                      <small id="keywordAnalysisKeywordsHelp" class="form-text text-muted" style="display:none;">Either
                        key in keywords and/or URL to proceed.</small>
                      <br>
                      <button class="btn btn-success" id="mapKeywordsBtn" onclick="mapKeywords()">Map
                        Keywords</button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-action">
                <button class="btn btn-success" id="keywordAnalysisSubmit" onclick="keywordAnalysis()">Submit</button>
                <button class="btn btn-danger" onclick="clearKeywordAnalysis()">Clear</button>
              </div>
            </div>
          </div>

          <div class='row'>
            <div class="card" id="keywordsSummaryCard" style="display: none;">
              <div class="card-header">
                <h4 id="keywordsSummaryHeader" class="card-title">Keywords Summary</h4>
              </div>
              <div class="card-body">
                <div class="table-responsive" style="height: auto;">
                  <table id="overall-summary" class="display table table-striped table-hover">
                  </table>
                </div>
              </div>
            </div>
          </div>

          <div class='row'>
            <div class="card" id="queriedKeywordsCard" style="display: none;">
              <div class="card-header">
                <h4 id="queriedKeywordsHeader" class="card-title">Queried Keywords</h4>
              </div>
              <div class="card-body">
                <div class="table-responsive" style="height: auto;">
                  <table id="queriedKeywordsTable" class="display table table-striped table-hover">
                    <thead>
                      <tr>
                        <th>No.</th>
                        <th>Keyword</th>
                        <th>Current Rank</th>
                        <th>URL</th>
                      </tr>
                    </thead>
                    <tbody>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="card" id="combinedCards" style="display:none">
                <div class="card-body">
                  <ul class="nav nav-pills nav-secondary" id="pills-tab" role="tablist">
                    <li class="nav-item">
                      <a class="nav-link active" id="pills-home-tab" data-bs-toggle="pill" href="#pills-home" role="tab"
                        aria-controls="pills-home" aria-selected="true">Ranked Keywords</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" id="pills-profile-tab" data-bs-toggle="pill" href="#pills-profile" role="tab"
                        aria-controls="pills-profile" aria-selected="false">Similar Keywords</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" id="pills-contact-tab" data-bs-toggle="pill" href="#pills-contact" role="tab"
                        aria-controls="pills-contact" aria-selected="false">Based on Content</a>
                    </li>
                  </ul>
                  <div class="tab-content mt-2 mb-3" id="pills-tabContent">
                    <div class="tab-pane fade show active" id="pills-home" role="tabpanel"
                      aria-labelledby="pills-ranking-tab">
                      <div class="table-responsive" style="height: 487px;">
                        <table id="rankingKeywordsTable" class="display table table-striped table-hover">
                          <thead>
                            <tr>
                              <th>Keyword</th>
                              <th>Search Vol</th>
                              <th>Rank</th>
                              <th>CPC</th>
                              <th>Add</th>
                            </tr>
                          </thead>
                          <tbody>
                          </tbody>
                        </table>
                      </div>
                    </div>
                    <div class="tab-pane fade show" id="pills-profile" role="tabpanel"
                      aria-labelledby="pills-profile-tab">
                      <div class="table-responsive">
                        <table id="similarKeywordsTable" class="display table table-striped table-hover">
                          <thead>
                            <tr>
                              <th>Keyword</th>
                              <th>Search Vol</th>
                              <th>Difficulty</th>
                              <th>CPC</th>
                              <th>Add</th>
                            </tr>
                          </thead>
                          <tbody>
                          </tbody>
                        </table>
                      </div>
                    </div>
                    <div class="tab-pane fade show" id="pills-contact" role="tabpanel"
                      aria-labelledby="pills-contact-tab">
                      <div class="table-responsive">
                        <table id="webpageKeywordsTable" class="display table table-striped table-hover">
                          <thead>
                            <tr>
                              <th>Keyword</th>
                              <th>Search Vol</th>
                              <th>Competition</th>
                              <th>Search Intent</th>
                              <th>Reason</th>
                              <th>Add</th>
                            </tr>
                          </thead>
                          <tbody>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card" id="serpCard" style="display: none;">
                <div class="card-header">
                  <h4 id="serpHeader" class="card-title">SERP</h4>
                </div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table id="serpTable" class="display table table-striped table-hover">
                      <thead>
                        <tr>
                          <th>Rank</th>
                          <th style="width: 15px;">URL</th>
                          <th>Title</th>
                          <th>Description</th>
                          <th>DA</th>
                        </tr>
                      </thead>
                      <tbody>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="card">
              <div class="card-header">
                <div class="card-title">Keyword Mapping</div>
              </div>
              <div class="card-body">
                <div class="d-flex justify-content-start mb-3">
                  <button class="btn btn-success me-2" onclick="addNewList()"><i class="fas fa-plus me-1"></i> Add New
                    URL</button>
                  <button class="btn btn-secondary" onclick="undoDelete()"><i class="fas fa-undo me-1"></i> Undo
                    Delete</button>
                </div>
                <div class="containerForMapping" id="listsContainer"></div>
                <div class="d-flex justify-content-around flex-wrap">
                  <div class="card shadow-sm mb-3" style="width: 280px;"></div>
                </div>
                <div id="onPageRecommendations"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <footer class="footer">
        <div class="container-fluid d-flex justify-content-between">
          <nav class="pull-left">
            <ul class="nav">
              <li class="nav-item">
                <a class="nav-link" href="http://www.themekita.com">
                  ThemeKita
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#"> Help </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#"> Licenses </a>
              </li>
            </ul>
          </nav>
          <div class="copyright">
            2024, made with <i class="fa fa-heart heart text-danger"></i> by
            <a href="http://www.themekita.com">ThemeKita</a>
          </div>
          <div>
            Distributed by
            <a target="_blank" href="https://themewagon.com/">ThemeWagon</a>.
          </div>
        </div>
      </footer>
    </div>
  </div>

  <script>
    // Help prompts
    const driver = window.driver.js.driver;

    steps = [
      { element: '#mascotBtn', popover: { title: 'Digimetrics Helper', description: 'Click on me to for a guided walkthrough.', side: "left", align: 'center' } },
      { element: '#keywordAnalysisKeywordsDiv', popover: { title: 'Animated Tour Example', description: 'Here is the code example showing animated tour. Let\'s walk you through it.', side: "bottom", align: 'center' } },
      { element: '#keywordAnalysisSubmit', popover: { title: 'Import the Library', description: 'It works the same in vanilla JavaScript as well as frameworks.', side: "bottom", align: 'start' } },
      { element: 'code .line:nth-child(2)', popover: { title: 'Importing CSS', description: 'Import the CSS which gives you the default styling for popover and overlay.', side: "bottom", align: 'start' } },
      { element: 'code .line:nth-child(4) span:nth-child(7)', popover: { title: 'Create Driver', description: 'Simply call the driver function to create a driver.js instance', side: "left", align: 'start' } },
      { element: 'code .line:nth-child(18)', popover: { title: 'Start Tour', description: 'Call the drive method to start the tour and your tour will be started.', side: "top", align: 'start' } },
      { element: 'a[href="/docs/configuration"]', popover: { title: 'More Configuration', description: 'Look at this page for all the configuration options you can pass.', side: "right", align: 'start' } },
      { popover: { title: 'Happy Coding', description: 'And that is all, go ahead and start adding tours to your applications.' } }
    ]

    const driverObj = driver({
      showProgress: false,
      steps: steps
    });

    driverObj.drive();

  </script>
  <!--   Core JS Files   -->
  <script src="assets/js/core/jquery-3.7.1.min.js"></script>
  <script src="assets/js/core/popper.min.js"></script>
  <script src="assets/js/core/bootstrap.min.js"></script>

  <!-- jQuery Scrollbar -->
  <script src="assets/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>

  <!-- Chart JS -->
  <script src="assets/js/plugin/chart.js/chart.min.js"></script>

  <!-- jQuery Sparkline -->
  <script src="assets/js/plugin/jquery.sparkline/jquery.sparkline.min.js"></script>

  <!-- Chart Circle -->
  <script src="assets/js/plugin/chart-circle/circles.min.js"></script>

  <!-- Datatables -->
  <script src="assets/js/plugin/datatables/datatables.min.js"></script>

  <!-- Bootstrap Notify -->
  <script src="assets/js/plugin/bootstrap-notify/bootstrap-notify.min.js"></script>

  <!-- jQuery Vector Maps -->
  <script src="assets/js/plugin/jsvectormap/jsvectormap.min.js"></script>
  <script src="assets/js/plugin/jsvectormap/world.js"></script>

  <!-- Sweet Alert -->
  <script src="assets/js/plugin/sweetalert/sweetalert.min.js"></script>

  <!-- Kaiadmin JS -->
  <script src="assets/js/kaiadmin.min.js"></script>
</body>

</html>